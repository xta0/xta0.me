---
layout: post
list_title: 漫谈C++ | Fun with C++
title: 自己实现智能指针
categories: [C++]
---

C++中的Smart Pointer相信大家都不陌生，今天我们来试着手动的实现一个智能指针。首先我们先仿照着`shared_ptr`的接口写一个模板如下

```cpp
template<typename T>
class smart_ptr {
public:
    explicit smart_ptr(T* ptr = nullptr):ptr_(ptr){}
    ~smart_ptr() { delete _ptr; }
    T* get() const { return _ptr; };
private:
    T* _ptr;
};
```
接下来我们希望`smart_ptr`具有指针功能，于是我们要重载下面的运算符

```cpp
T& operator*() const { return *_ptr; }
T* operator->() const { return _ptr; }
//支持布尔运算
operator bool() const { return _ptr; }
```

### 拷贝问题

简单的部分处理完了，接下来我们要仔细讨论下拷贝的实现，因为它直接影响着smart pointer的行为，比如，如何处理引用计数，如何处理内存等。在实现前，我们先看看可能会有哪些使用场景，比如下面这样

```cpp
smart_ptr<T> ptr1{new T()};
smart_ptr<T> ptr2 = ptr1;
smart_ptr<T> ptr3{ptr2};
```

