I"Ô+<p>Objective-Cçš„<code class="highlighter-rouge">[...]</code>è¯­æ³•æ¥æºäºsmallTalkï¼Œå…¶è®¾è®¡åˆè¡·æ˜¯å¸Œæœ›å®ƒæ˜¯ä¸€ç§åŠ¨æ€çš„ï¼Œåœ¨è¿è¡Œæ—¶å†³å®šå‡½æ•°çš„å…¥å£åœ°å€ã€‚ç”±äºobjective-Cæœ¬è´¨ä¸Šä¹Ÿè¿˜æ˜¯Cè¯­è¨€ï¼Œå› æ­¤[â€¦]è¯­æ³•åœ¨ç¼–è¯‘åå®é™…ä¸Šæ˜¯ä¸€æ¡æ ‡å‡†Cå‡½æ•°ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">id</span> <span class="n">objc_msgSend</span><span class="p">(</span><span class="n">id</span> <span class="n">self</span><span class="p">,</span> <span class="n">SEl</span> <span class="n">OP</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div></div>

<p>è€ŒCè¯­è¨€æ˜¯ä¸€ç§é™æ€è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°çš„å…¥å£åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†(static binding)ã€‚ä¾‹å¦‚è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="kt">void</span> <span class="nf">searchProduct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"searching product"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="kt">void</span> <span class="nf">searchShop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"searching shop"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">search_static</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">searchProduct</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">searchShop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ä¸è®©ç¼–è¯‘å™¨å»è‡ªåŠ¨inlineä»£ç ï¼ŒsearchProductå’ŒsearchShopåœ¨ç¼–è¯‘çš„æ—¶å€™åœ°å€å·²ç»ç¡®å®šäº†ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.globl _search_static
_search_static: ## @search_static
.cfi_startproc
Lfunc_begin2:
.loc 1 48 0
pushq %rbp

...................

Ltmp20:&lt;/span&gt;
 ## BB#1:
.loc 1 50 0
popq %rbp
jmp _searchProduct ## TAILCALL
Ltmp21:&lt;/span&gt;
LBB2_2:&lt;/span&gt;
.loc 1 53 0
popq %rbp
jmp _searchShop ## TAILCALL
Ltmp22:&lt;/span&gt;
Lfunc_end2:
.cfi_endproc
</code></pre></div></div>

<p>å¦‚æœæŠŠä¸Šé¢ä»£ç æ”¹å†™æˆä¸‹é¢è¿™æ ·ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="kt">void</span> <span class="nf">searchProduct</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"searching product"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span><span class="kt">void</span> <span class="nf">searchShop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"searching shop"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">search_dynamic</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">searchProduct</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">searchShop</span><span class="p">;</span>
    
    <span class="n">func</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™æ ·å°±å˜æˆäº†è¿è¡Œæ—¶å†³å®šå‡½æ•°åœ°å€äº†ã€‚è¿™ç§æ–¹å¼å¥½å¤„æ˜¯å¾ˆçµæ´»ï¼Œä½ ç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç¨‹åºæ‰§è¡Œçš„ç»“æœã€‚ä½†æ˜¯åå¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯éœ€è¦è®¡ç®—ï¼Œæ…¢ã€‚å›é€€åˆ°1986å¹´ï¼ŒOCå’ŒC++éƒ½åˆšåˆšé—®ä¸–ï¼ŒåŒæ˜¯é¢å‘å¯¹è±¡ï¼ŒC++å› ä¸ºå…¶åœ¨ç¼–è¯‘å™¨åšå¤§é‡çš„äº‹è€Œé€Ÿåº¦æ›´å¿«ï¼ŒOCç”±äºå—å½“æ—¶ç¡¬ä»¶æ¡ä»¶ï¼Œè¿™ç§åŠ¨æ€ç»‘å®šçš„åšæ³•æ•ˆç‡å¾€å¾€å¾ˆä½ã€‚</p>

<p>åŸºæœ¬ä¸ŠOCçš„å‡½æ•°æ‰§è¡Œéƒ½æ˜¯éµå¾ªä¸Šé¢è¿™ç§æ¨¡å¼ï¼Œåˆ¤æ–­æ‰§è¡Œé‚£ä¸ªå‡½æ•°çš„æ¡ä»¶æ˜¯objc_msgSendçš„SELå‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªopaque string:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SEL</span> <span class="n">someSelector</span> <span class="o">=</span> <span class="n">NSSelectorFromString</span><span class="p">(</span><span class="s">@"dealloc"</span><span class="p">)</span>
</code></pre></div></div>
<p>è€Œå‡½æ•°çš„å…¥å£åœ°å€ä¿å­˜åœ¨äº†ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">objc_method_list</span> <span class="o">**</span><span class="n">methodLists</span> 
</code></pre></div></div>
<p>ä¸ºäº†æ•ˆç‡è€ƒè™‘ï¼Œè¿™äº›åœ°å€è¢«è°ƒç”¨è¿‡åä¼šcacheä½</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">objc_cache</span> <span class="o">*</span><span class="n">cache</span>  
</code></pre></div></div>
<p>ä¾‹å¦‚ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2   CoreFoundation                      0x01a0c903 -[NSObject<span class="o">(</span>NSObject<span class="o">)</span> doesNotRecognizeSelector:] + 275
3   CoreFoundation                      0x0195f90b ___forwarding___ + 1019
4   CoreFoundation                      0x0195f4ee _CF_forwarding_prep_0 + 14
5   libobjc.A.dylib                     0x014c6275 _class_initialize + 599
6   libobjc.A.dylib                     0x014cd0f1 lookUpImpOrForward + 158
7   libobjc.A.dylib                     0x014cd04e _class_lookupMethodAndLoadCache3 + 55
8   libobjc.A.dylib                     0x014d512f objc_msgSend + 139
9   UIKit                               0x0034b9d4 -[UIViewController loadViewIfReq
</code></pre></div></div>

<p>è™½ç„¶æœ‰cacheæˆ–æœ‰ä¸€äº›ä¼˜åŒ–åœ¨ï¼Œä½†æ•ˆç‡æ¯•ç«Ÿè¿˜æ˜¯ä½äºstatic bindingï¼Œä½†å¯¹äºç°åœ¨çš„ç¡¬ä»¶æ¡ä»¶æ¥è®²ï¼Œè¿™ä¸ªä¹Ÿä¸ç®—æ˜¯ç“¶é¢ˆã€‚</p>

<h3 id="overloadingçš„é—®é¢˜">Overloadingçš„é—®é¢˜</h3>

<p>ä½¿ç”¨Javaæˆ–è€…C++ï¼Œoverloadingæ˜¯ç§å¾ˆå¸¸è§çš„ç­–ç•¥ï¼Œæˆ–è€…å¾ˆå¤šäººä¹ æƒ¯é€šè¿‡overloadingçš„å‚æ•°æ¥åŒºåˆ«æ–¹æ³•çš„æ„æ€ã€‚ä½†æ˜¯è¿™ç§æŠ€æœ¯åœ¨OCä¸­å´è¡Œä¸é€šï¼Œé“ç†ä¹Ÿå¾ˆç®€å•ï¼Œoverloadingä¹Ÿæ˜¯ä¸€ç§static bindingã€‚</p>

<p>ä»¥Javaä»£ç ä¸ºä¾‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">testObj</span>
<span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">searchProduct</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
	<span class="o">}</span>
	
	 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">searchProduct</span><span class="o">(</span><span class="kt">int</span> <span class="n">type</span><span class="o">)</span>
	 <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%d\n"</span><span class="o">,</span><span class="n">type</span><span class="o">);</span>
	 <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">main</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="n">testObj</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">testObj</span><span class="o">();</span>
		
		<span class="n">obj</span><span class="o">.</span><span class="na">searchProduct</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
		<span class="n">obj</span><span class="o">.</span><span class="na">searchProduct</span><span class="o">(</span><span class="s">"iphone"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°main.classä¸­ï¼Œæ–¹æ³•çš„å…¥å£åœ°å€ä¹Ÿç¡®å®šäº†ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void main<span class="o">(</span>java.lang.String[]<span class="o">)</span><span class="p">;</span>
  Code:
  <span class="nv">Stack</span><span class="o">=</span>2, <span class="nv">Locals</span><span class="o">=</span>2, <span class="nv">Args_size</span><span class="o">=</span>1
  0:	new	<span class="c">#15; //class testObj</span>
  3:	dup
  4:	invokespecial	<span class="c">#17; //Method testObj."&lt;init&gt;":()V</span>
  7:	astore_1
  8:	aload_1
  9:	iconst_0
  10:	invokevirtual	<span class="c">#18; //Method testObj.searchProduct:(I)V</span>
  13:	aload_1
  14:	ldc	<span class="c">#22; //String iphone</span>
  16:	invokevirtual	<span class="c">#24; //Method testObj.searchProduct:(Ljava/lang/String;)</span>
</code></pre></div></div>
<p>ä¸ºä»€ä¹ˆOCä¸è¡Œå‘¢ï¼Ÿ</p>

<p>å¯¹åŒåçš„æ–¹æ³•ï¼Œå‚æ•°ç±»å‹ä¸åŒï¼Œä»…é SELæ˜¯æ— æ³•åŒºåˆ«çš„ï¼š</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@selector</span><span class="p">(</span><span class="n">searchProduct</span><span class="o">:</span><span class="p">)</span>
</code></pre></div></div>
<p>å¦‚æœæœ‰åŒåæ–¹æ³•ï¼Œè°çŸ¥é“è¯¥è°ƒç”¨å“ªä¸€ä¸ªå‘¢ï¼Ÿ</p>

:ET