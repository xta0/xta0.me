I"‹2<h2 id="c-å·¥ç¨‹ç»“æ„">C å·¥ç¨‹ç»“æ„</h2>

<p>ä¸€ä¸ªå…¸å‹çš„Cå·¥ç¨‹(libåº“)çš„å·¥ç¨‹ç»“æ„å¯å‚è€ƒå¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c-project
â”œâ”€â”€ LECENCE
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ bin
â”œâ”€â”€ build
â”œâ”€â”€ src
â”‚   â””â”€â”€ dbg.h
â””â”€â”€ tests
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">bin</code>ï¼šç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•</li>
  <li><code class="highlighter-rouge">build</code>ï¼šåº“æ–‡ä»¶(<code class="highlighter-rouge">.a</code>)å­˜æ”¾ç›®å½•ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿ</li>
  <li><code class="highlighter-rouge">src</code>: å­˜æ”¾æºç </li>
  <li><code class="highlighter-rouge">test</code>: å­˜æ”¾å•å…ƒæµ‹è¯•æ–‡ä»¶</li>
</ul>

<h2 id="ä½¿ç”¨makefile">ä½¿ç”¨Makefile</h2>

<p>å½“ä¸€ä¸ªå·¥ç¨‹å¾ˆå¤§ï¼Œæœ‰å¾ˆå¤šæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨gccç¼–è¯‘å°±å±€é™äº†ã€‚è¿™ä¸ªæ—¶å€™é€šå¸¸ä½¿ç”¨makefileï¼Œmakefileä¸­ï¼Œéœ€è¦æŠŠè¿™äº›æ–‡ä»¶ç»„ç»‡åˆ°ä¸€èµ·ã€‚makefileæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªshellè„šæœ¬(å…³äºShellè„šæœ¬å¯ä»¥å‚è€ƒ<a href="">è¿™é‡Œ</a>ï¼Œç¬¦å·å¯¹å¤§å°å†™æ•æ„Ÿï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Makefileæ–‡ä»¶ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CC=gcc
CFLAGS=-Wall -g
LDFLAGS=
SOURCES=main.cpp hello.cpp factorial.cpp
OBJECTS=$(SOURCES:.cpp=.o)
EXECUTABLE=hello
all: $(SOURCES) $(EXECUTABLE)
$(EXECUTABLE): $(OBJECTS)
    $(CC) $(LDFLAGS) $(OBJECTS) -o $@
.cpp.o:
    $(CC) $(CFLAGS) $&lt; -o $@
</code></pre></div></div>

<ul>
  <li>CC: ç¼–è¯‘å™¨åç§°
    <ul>
      <li><code class="highlighter-rouge">% gcc  main.c</code> åœ¨makefileä¸­çš„å†™æ³•ä¸ºï¼š<code class="highlighter-rouge">$(CC) main.c</code></li>
    </ul>
  </li>
  <li>CFLAGS: ç¼–è¯‘å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„gccçš„ç¼–è¯‘é€‰é¡¹ã€‚
    <ul>
      <li><code class="highlighter-rouge">CFLAGS=-Wall -g</code></li>
      <li>é€šå¸¸ç”¨æ¥æŒ‡å®šå¤´æ–‡ä»¶çš„ä½ç½®ï¼Œå¸¸ç”¨çš„æ˜¯<code class="highlighter-rouge">-I, -g</code>ã€‚</li>
    </ul>
  </li>
  <li>LDFLAGS: é“¾æ¥å‚æ•°ï¼Œå‘Šè¯‰é“¾æ¥å™¨libçš„ä½ç½®
    <ul>
      <li>å¸¸ç”¨çš„æœ‰<code class="highlighter-rouge">-I,-L</code></li>
    </ul>
  </li>
  <li>SOURCES: æ‰€æœ‰<code class="highlighter-rouge">.c</code>æ–‡ä»¶è·¯å¾„</li>
  <li>OBJECTS: æ‰€æœ‰<code class="highlighter-rouge">.o</code>æ–‡ä»¶è·¯å¾„</li>
  <li>EXECUTABLE: ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶åç§°</li>
  <li>action: <code class="highlighter-rouge">all</code>ï¼Œ<code class="highlighter-rouge">clean</code>ä¸ºactionï¼Œå¯ä»¥ç”¨<code class="highlighter-rouge">make action</code>æ¥æ‰§è¡ŒæŸä¸ªaction
    <ul>
      <li><mark>å¦‚æœä¸æŒ‡å®šactionï¼Œé»˜è®¤æ‰§è¡ŒMakefileä¸­çš„ç¬¬ä¸€ä¸ªaction</mark></li>
    </ul>
  </li>
</ul>

<h3 id="mekfileçš„å·¥ä½œåŸç†">Mekfileçš„å·¥ä½œåŸç†</h3>

<p>å½“æ‰§è¡Œ<code class="highlighter-rouge">make</code>æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾Makefileï¼Œæ‰¾åˆ°ä¹‹åä»ç¬¬ä¸€ä¸ªTARGETå¼€å§‹è§£æå…¶ä¾èµ–çš„å˜é‡æˆ–å…¶ä»–æ¡ä»¶ã€‚Makefileçš„ä¸€æ¡Ruleçš„æ ¼å¼ä¸º</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target: prerequisites
	recipe
	â€¦
	â€¦
</code></pre></div></div>
<ul>
  <li>targetæœ‰ä¸¤ä¸ªå«ä¹‰
    <ul>
      <li>è¦buildçš„<mark>æ–‡ä»¶å+åç¼€</mark></li>
      <li>æŸä¸ªactionï¼ˆæ¯”å¦‚ä¸Šé¢æåˆ°çš„<code class="highlighter-rouge">clean</code>ï¼‰</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">prerequisites</code>ä¸ºtargetçš„ä¾èµ–ï¼ŒåŒ…å«ï¼š
    <ul>
      <li>åœ¨æ‰§è¡Œtargetå‰éœ€è¦æ‰§è¡Œçš„action</li>
      <li>åœ¨<code class="highlighter-rouge">recipe</code>ä¸­éœ€è¦çš„å‚æ•°</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">recipe</code>åˆ™ä¸ºè¿™ä¸ªactionå…·ä½“æ‰§è¡Œçš„shellå‘½ä»¤ï¼Œæ¯æ¡å‘½ä»¤å•ç‹¬ä¸€è¡Œï¼Œå‰é¢ç”¨tabç©ºæ ¼</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>myprogam: main.o foo.o <span class="c">#ç¼–è¯‘myprogamæ–‡ä»¶ï¼Œä¾èµ–main.o,foo.oä¸¤ä¸ªæ–‡ä»¶</span>
    gcc <span class="nt">-o</span> myprogram main.o foo.o <span class="c">#shellå‘½ä»¤</span>

main.o: main.c foo.h <span class="c">#äº§ç”Ÿmain.o éœ€è¦main.c, foo.h</span>
    gcc <span class="nt">-c</span> main.c

foo.o: foo.c foo.h
    gcc <span class="nt">-c</span> foo.c
</code></pre></div></div>

<h3 id="a-makefile-demo">A Makefile Demo</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CFLAGS=-g -O2 -Wall -Wextra -Isrc -rdynamic -DNDEBUG $(OPTFLAGS)
LIBS=-ldl $(OPTLIBS)

PREFIX?=/usr/local
SOURCES=$(wildcard src/**/*.c src/*.c)
OBJECTS=$(patsubst %.c,%.o,$(SOURCES))

TEST_SRC=$(wildcard tests/*_tests.c)
TESTS=$(patsubst %.c,%,$(TEST_SRC))

TARGET=build/libYOUR_LIBRARY.a
SO_TARGET=$(patsubst %.a,%.so,$(TARGET))

# The Target Build
all: $(TARGET) $(SO_TARGET) tests

dev: CFLAGS=-g -Wall -Isrc -Wall -Wextra $(OPTFLAGS)
dev: all

$(TARGET): CFLAGS += -fPIC
$(TARGET): build $(OBJECTS)
	ar rcs $@ $(OBJECTS)
	ranlib $@

$(SO_TARGET): $(TARGET) $(OBJECTS)
	$(CC) -shared -o $@ $(OBJECTS)

build:
	@mkdir -p build
	@mkdir -p bin

# The Unit Tests
.PHONY: tests
tests: CFLAGS += $(TARGET)
tests: $(TESTS)
	sh ./tests/runtests.sh

# The Cleaner
clean:
	rm -rf build $(OBJECTS) $(TESTS)
	rm -f tests/tests.log
	find . -name "*.gc*" -exec rm {} \;
	rm -rf `find . -name "*.dSYM" -print`

# The Install
install: all
	install -d $(DESTDIR)/$(PREFIX)/lib/
	install $(TARGET) $(DESTDIR)/$(PREFIX)/lib/

# The Checker
check:
	@echo Files with potentially dangerous functions.
	@egrep '[^_.&gt;a-zA-Z0-9](str(n?cpy|n?cat|xfrm|n?dup|str|pbrk|tok|_)\
		|stpn?cpy|a?sn?printf|byte_)' $(SOURCES) || true

</code></pre></div></div>

<blockquote>
  <p>ä¸Šé¢çš„Makefileæ˜¯ä¸ªäººä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œä¸åŒå¼€å‘äººå‘˜å¯èƒ½ä¼šç»´æŠ¤å„è‡ªçš„ç‰ˆæœ¬ï¼Œç»“æ„å¤§åŒå°å¼‚</p>
</blockquote>

<ul>
  <li><code class="highlighter-rouge">SOURCES</code>ï¼šGNU Makeä¸­æä¾›äº†ä¸€ä¸ªå‡½æ•°å«<code class="highlighter-rouge">wildcard</code>ï¼Œå®ƒå¯ä»¥å°†æ‰€æœ‰ç¬¦åˆç”±å…¶å‚æ•°æè¿°çš„æ–‡ä»¶å±•å¼€ï¼Œä»¥ç©ºæ ¼é—´éš”ã€‚å› æ­¤å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°å±•å¼€<code class="highlighter-rouge">src</code>è·¯å¾„ä¸‹æ‰€æœ‰çš„<code class="highlighter-rouge">.c</code>æ–‡ä»¶</li>
  <li><code class="highlighter-rouge">OBJECTS</code>: ä½¿ç”¨äº†å¦ä¸€ä¸ªGNU Makeä¸­çš„å‡½æ•°<code class="highlighter-rouge">patsubst</code>ï¼Œå®ƒéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š
    <ul>
      <li>ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªéœ€è¦åŒ¹é…çš„å¼æ ·ï¼›ç¬¬äºŒä¸ªè¡¨ç¤ºç”¨ä»€ä¹ˆæ¥æ›¿æ¢å®ƒï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸€ä¸ªéœ€è¦è¢«å¤„ç†çš„ç”±ç©ºæ ¼åˆ†éš”çš„åˆ—è¡¨</li>
      <li>ä½¿ç”¨<code class="highlighter-rouge">patsubst</code>å¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆ<code class="highlighter-rouge">.o</code>æ–‡ä»¶åˆ—è¡¨</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">$(OPTFLAGS),$(OPTLIBS)</code>ä¸ºæ‰§è¡Œmakeå‘½ä»¤æ—¶çš„é™„åŠ å‚æ•°
    <ul>
      <li><code class="highlighter-rouge">make OPTFLAGS=-pthread</code></li>
      <li>å¦‚æœé™„åŠ å‚æ•°å’ŒMakefileä¸­æŸé¡¹optionå´‡æ˜ï¼Œåˆ™ä¼šè¦†ç›–æ‰Makefileä¸­è¯¥optionçš„å€¼
        <ul>
          <li><code class="highlighter-rouge">make PREFIX=/tmp install #installs the lib to /tmp</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">TARGET/SO_TARGET</code>: ç¼–è¯‘ååº“æ–‡ä»¶ç›®å½•</li>
  <li><code class="highlighter-rouge">all</code>: é»˜è®¤çš„makeå‘½ä»¤ï¼Œä¾æ¬¡æ‰§è¡Œ<code class="highlighter-rouge">$(TARGET) $(SO_TARGET) tests</code>è¿™ä¸‰æ¡rule</li>
  <li><code class="highlighter-rouge">$(TARGET)</code>: å…·ä½“çš„ç¼–è¯‘æŒ‡ä»¤ï¼Œä¾èµ–buildå’Œ<code class="highlighter-rouge">$(OBJECT)</code>,å‰è€…åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œåè€…ä¸ºshellå‘½ä»¤å‚æ•°</li>
</ul>

<h2 id="c-ç¨‹åºè°ƒè¯•">C ç¨‹åºè°ƒè¯•</h2>

<blockquote>
  <p>ç°ä»£å¯è§†åŒ–çš„ç¼–è¾‘å™¨å¦‚Visual Studio, XCodeé›†æˆäº†å¾ˆæ–¹ä¾¿å¥½ç”¨çš„è°ƒè¯•å·¥å…·ï¼Œä½¿ç”¨è¿™äº›å·¥å…·å¯ä»¥æå¤§çš„æå‡æ•ˆç‡ï¼Œä¸å¿…çº ç»“äºå‘½ä»¤è¡Œ+GDB/LLDBçš„æ–¹å¼</p>
</blockquote>

<h3 id="gdb--lldb">GDB &amp; LLDB</h3>

<ul>
  <li>GDB tricks
    <ul>
      <li><code class="highlighter-rouge">gdb --args [PROGRAM]</code> Normally, gdb takes arguments you give it and assumes they are for itself. Using â€“args passes them to the program.</li>
      <li><code class="highlighter-rouge">thread apply all bt</code> .Dump a backtrace for all threads. Itâ€™s very useful.</li>
      <li><code class="highlighter-rouge">gdb --batch --ex run --ex bt --ex q --args [PROGRAM] [ARGS]</code>Run the program so that if it bombs, you get a backtrace.</li>
    </ul>
  </li>
  <li>GDBå‚è€ƒ
    <ul>
      <li><code class="highlighter-rouge">run [args]</code> Start your program with <code class="highlighter-rouge">[args]</code>.</li>
      <li><code class="highlighter-rouge">break [file:]</code> function Set a break point at [file:]function. You can also use b.</li>
      <li><code class="highlighter-rouge">backtrace</code> Dump a backtrace of the current calling stack. Shorthand is <code class="highlighter-rouge">bt</code>.</li>
      <li><code class="highlighter-rouge">print expr</code> Print the value of expr. Shorthand is <code class="highlighter-rouge">p</code>.</li>
      <li><code class="highlighter-rouge">continue</code> Continue running the program. Shorthand is <code class="highlighter-rouge">c</code>.</li>
      <li><code class="highlighter-rouge">next</code> Next line, but step over function calls. Shorthand is <code class="highlighter-rouge">n</code>.</li>
      <li><code class="highlighter-rouge">step</code> Next line, but step into function calls. Shorthand is <code class="highlighter-rouge">s</code>.</li>
      <li><code class="highlighter-rouge">quit</code> Exit GDB.</li>
      <li><code class="highlighter-rouge">help</code> List the types of commands. You can then get help on the class of command as well as
  the command.</li>
      <li><code class="highlighter-rouge">cd</code>, <code class="highlighter-rouge">pwd</code>, <code class="highlighter-rouge">make</code> just like running these commands in your shell.</li>
      <li><code class="highlighter-rouge">shell</code> Quickly start a shell so you can do other things.</li>
      <li><code class="highlighter-rouge">clear</code> Clear a breakpoint.</li>
      <li><code class="highlighter-rouge">info break</code>, <code class="highlighter-rouge">info watch</code> Show information about breakpoints and watchpoints.</li>
      <li><code class="highlighter-rouge">attach pid</code> Attach to a running process so you can debug it.</li>
      <li><code class="highlighter-rouge">detach</code> Detach from the process.</li>
      <li><code class="highlighter-rouge">list</code> List out the next ten source lines. Add a  to list the previous ten lines.</li>
    </ul>
  </li>
  <li>LLDBå‚è€ƒ
    <ul>
      <li><code class="highlighter-rouge">run [args]</code> Start your program with [args].</li>
      <li><code class="highlighter-rouge">breakpoint set --name [file:]function</code> Set a break point at [file:]function. You can also
  use <code class="highlighter-rouge">b</code>, which is way easier.</li>
      <li><code class="highlighter-rouge">thread backtrace</code> Dump a backtrace of the current calling stack. Shorthand is <code class="highlighter-rouge">bt</code>.</li>
      <li><code class="highlighter-rouge">print expr</code> Print the value of expr. Shorthand is <code class="highlighter-rouge">p</code>.</li>
      <li><code class="highlighter-rouge">continue</code> Continue running the program. Shorthand is <code class="highlighter-rouge">c</code>.</li>
      <li><code class="highlighter-rouge">next</code> Next line, but step over function calls. Shorthand is <code class="highlighter-rouge">n</code>.</li>
      <li><code class="highlighter-rouge">step</code> Next line, but step into function calls. Shorthand is <code class="highlighter-rouge">s</code>.</li>
      <li><code class="highlighter-rouge">quit</code> Exit LLDB.</li>
      <li><code class="highlighter-rouge">help</code> List the types of commands. You can then get help on the class of command as well as
  the command itself.</li>
      <li><code class="highlighter-rouge">cd</code>, <code class="highlighter-rouge">pwd</code>, <code class="highlighter-rouge">make</code> just like running these commands in your shell.</li>
      <li><code class="highlighter-rouge">shell</code> Quickly start a shell so you can do other things.</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ä½¿ç”¨GDBè°ƒè¯•éœ€è¦æœ‰debug symbolï¼ŒGCCç¼–è¯‘æ—¶åŠ å…¥<code class="highlighter-rouge">-g</code>ç”Ÿæˆç¬¦å·æ–‡ä»¶ï¼ˆä¾‹å¦‚XCodeä¼šç”Ÿæˆ .dSYMæ–‡ä»¶ï¼‰</p>
</blockquote>

<h2 id="resource">Resource</h2>

<ul>
  <li><a href="https://learncodethehardway.org/">LCTHW</a></li>
  <li><a href="&quot;http://cslibrary.stanford.edu/107/UnixProgrammingTools.pdf&quot;">UNIX Programming Tools</a></li>
  <li><a href="https://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">GCCç¼–è¯‘å‚æ•°</a></li>
  <li><a href="https://www.gnu.org/software/make/manual/html_node/index.html#SEC_Contents">GNU make</a></li>
</ul>
:ET