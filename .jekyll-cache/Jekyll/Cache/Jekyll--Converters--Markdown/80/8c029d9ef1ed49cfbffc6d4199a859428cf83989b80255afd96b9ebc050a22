I"ì<p>å¿«é€Ÿçœ‹ä¸€ä¸‹TCP connectionçš„å…·ä½“è¿‡ç¨‹ï¼Œç®€å•å†™äº†ä¸€ä¸ªTCP server é…åˆ<code class="highlighter-rouge">wireshark</code>æ¥åšä¸€äº›åˆ†æï¼š</p>

<h3 id="å»ºç«‹ä¸‰æ­¥æ¡æ‰‹">å»ºç«‹ä¸‰æ­¥æ¡æ‰‹</h3>

<ul>
  <li><strong>SYN</strong></li>
</ul>

<p>C(client)å‘Sï¼ˆserverï¼‰å‘é€è¯·æ±‚ï¼ŒSYNæ ‡å¿—ä½ä¸º1ï¼Œäº§ç”Ÿä¸€ä¸ªéšæœºçš„32bit Seq Num:0x0b97d19cï¼ŒTCP headerå¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: 54133 (54133)
Destination port: mit-dov (91)
[Stream index: 0]
Sequence number: 0x0b97d19c
Header length: 44 bytes
Flags: 0x002 (SYN)
Window size value: 65535
[Calculated window size: 65535]
Checksum: 0xfc9c [validation disabled]
</code></pre></div></div>

<ul>
  <li><strong>ACK+SYN</strong></li>
</ul>

<p>Sæ”¶åˆ°åï¼Œå°†SYNå’ŒACKæ ‡å¿—ä½è‡³ä¸º1ï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªæ–°çš„Seq Numï¼š0x0f8baa6eå’Œä¸€ä¸ªAck Numï¼š0x0b97d19dï¼ˆCçš„Seq Num+1ï¼‰</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: mit-dov (91)
Destination port: 54133 (54133)
[Stream index: 0]
Sequence number: 0x0f8baa6e    
Acknowledgment number: 0x0b97d19d
Header length: 44 bytes
Flags: 0x012 (SYN, ACK)
Window size value: 65535
[Calculated window size: 65535]
Checksum: 0xb0cc [validation disabled]
</code></pre></div></div>

<ul>
  <li><strong>ACK</strong></li>
</ul>

<p>Cæ”¶åˆ°åï¼Œå…ˆæ ¡éªŒSeq Numå¯¹ä¸å¯¹ï¼Œå¦‚æœæ­£ç¡®ï¼Œå°†ACKæ ‡å¿—ä½è‡³ä¸º1ï¼ŒåŒæ—¶äº§ç”Ÿæ–°çš„Ack Numä¸º0x0f8baa6f(Sçš„Seq Num+1)ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: 54133 (54133)
Destination port: mit-dov (91)
[Stream index: 0]
Sequence number: 0x0b97d19d
Acknowledgment: 0x0f8baa6f
Header length: 32 bytes
Flags: 0x010 (ACK)
Window size value: 8235
[Calculated window size: 131760]
[Window size scaling factor: 16]
Checksum: 0xcf36 [validation disabled]
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œä¸‰æ­¥æ¡æ‰‹å®Œæˆ,é“¾æ¥å»ºç«‹ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œåœ¨ç¬¬ä¸‰æ­¥çš„æ—¶å€™ï¼ŒCå‘Sé€šçŸ¥äº†è‡ªå·±windowçª—çš„å¤§å°ï¼š8235å’Œ scaling factorï¼š16ã€‚å…³äºæµæ§å’Œæ»‘åŠ¨çª—å£ä¸åœ¨è¿™é‡Œè®¨è®ºï¼Œä½†æ˜¯å½“Sæ”¶åˆ°åï¼Œéœ€è¦è°ƒæ•´è‡ªå·±çš„window sizeç„¶åç»™Cä¸€ä¸ªåº”ç­”ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: mit-dov (91)
Destination port: 54133 (54133)
[Stream index: 0]
Sequence number: 0x0f8baa6f
Acknowledgment number: 0x0b97d19d
Header length: 32 bytes
Flags: 0x010 (ACK)
Window size value: 8235
[Calculated window size: 131760]
[Window size scaling factor: 16]
Checksum: 0xcf34 [validation disabled]
Options: (12 bytes), No-Operation (NOP), No-Operation (NOP), Timestamps
</code></pre></div></div>

<h3 id="æ•°æ®ä¼ è¾“">æ•°æ®ä¼ è¾“</h3>

<p>4ä¸ªåŒ…äº¤æ¢å®Œæ¯•åï¼Œé“¾æ¥å·²ç»å»ºç«‹ï¼Œç„¶åCå‘Så‘æ•°æ®ï¼šâ€iam:aâ€ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒPSHå’ŒACKä¸¤ä¸ªflagè¢«ç½®ä¸º1ï¼ŒPSHé€šçŸ¥Sæœ‰æ•°æ®åˆ°æ¥ï¼Œéœ€è¦å†™å…¥ã€‚åŒæ—¶å°†æ•°æ®è£…å…¥TCPçš„dataéƒ¨åˆ†ã€‚ç”±äºæœ‰äº†dataï¼Œä¸‹ä¸€æ¡seq numçš„å€¼è¦åŠ ä¸Šdataçš„sizeï¼ˆ5ï¼‰</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ack: 1, Len: 5
Source port: 54133 (54133)
Destination port: mit-dov (91)
[Stream index: 0]
Sequence number: 0x0b97d19d
[Next sequence number: 0x0b97d19d+0x5]
Acknowledgment number:0x0f8baa6f
Header length: 32 bytes
Flags: 0x018 (PSH, ACK)
Window size value: 8235
[Calculated window size: 131760]
[Window size scaling factor: 16]
Checksum: 0x6552 [validation disabled]
Options: (12 bytes), No-Operation (NOP), No-Operation (NOP), Timestamps
[SEQ/ACK analysis]
Data (5 bytes)0000  69 61 6d 3a 61                                    iam:a
Data: 69616d3a61
[Length: 5]
</code></pre></div></div>

<p>Sæ”¶åˆ°åï¼Œè¦ç»™å‡ºACKåº”ç­”ï¼Œé‡ç‚¹å…³æ³¨Ack Numï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: mit-dov (91)
Destination port: 54133 (54133)
[Stream index: 0]
Sequence number:0x0f8baa6f
Acknowledgment number: 0x0b97d1a2
Header length: 32 bytes
Flags: 0x010 (ACK)
Window size value: 8235
[Calculated window size: 131760]
[Window size scaling factor: 16]
Checksum: 0x69bf [validation disabled]
Options: (12 bytes), No-Operation (NOP), No-Operation (NOP), Timestamps
</code></pre></div></div>

<p>éšåçš„ä¸€ä¸ªåŒ…æ˜¯Så‘Cå‘çš„[PSH,ACK]ï¼Œç„¶åCåº”ç­”[ACK]ã€‚è¿‡ç¨‹åŒä¸Šã€‚</p>

<h3 id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</h3>

<p>TCPç»“æŸæ—¶éœ€è¦å››ä¸ªåŒ…ï¼Œå‡è®¾Cå‘Sè¯·æ±‚å…³é—­è¿æ¥ã€‚Sä¼šå‘Cå‘é€[FIN,ACK]:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: 54133 (54133)
Destination port: mit-dov (91)
[Stream index: 0]
Sequence number: 12    (relative sequence number)
Acknowledgment number: 14    (relative ack number)
Header length: 32 bytes
Flags: 0x011 (FIN, ACK)
Window size value: 8234
[Calculated window size: 131744]
[Window size scaling factor: 16]
Checksum: 0x3485 [validation disabled]
</code></pre></div></div>

<p>Cæ”¶åˆ°åï¼Œä¼šå…ˆ[ACK]ï¼Œç„¶ååŒæ ·å‘é€ä¸€ä¸ª[FIN,ACK]åˆ°Sï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source port: 54133 (54133)
Destination port: mit-dov (91)
[Stream index: 0]
Sequence number: 12    (relative sequence number)
Acknowledgment number: 14    (relative ack number)
Header length: 32 bytes
Flags: 0x011 (FIN, ACK)
Window size value: 8234
[Calculated window size: 131744]
[Window size scaling factor: 16]
Checksum: 0x3485 [validation disabled]
</code></pre></div></div>

<p>Sæ”¶åˆ°åï¼Œä¼šç»™Cä¸€ä¸ª[ACK]ï¼Œç„¶åè¿æ¥ç»ˆæ­¢ã€‚</p>

<h2 id="resources">Resources</h2>
:ET