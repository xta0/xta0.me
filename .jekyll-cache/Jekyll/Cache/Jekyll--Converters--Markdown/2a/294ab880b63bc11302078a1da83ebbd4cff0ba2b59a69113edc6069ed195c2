I"æ<h1 id="unix-shell-part-3">Unix Shell Part 3</h1>

<h2 id="shell-scripts">Shell Scripts</h2>

<ul>
  <li><a href="#1">Overview</a></li>
  <li><a href="#2">å˜é‡</a></li>
  <li><a href="#3">å­—ç¬¦ä¸²æ“ä½œ</a></li>
  <li><a href="#4">æ•°å­¦è¿ç®—</a></li>
  <li><a href="#5">æµ®ç‚¹è¿ç®—</a></li>
  <li><a href="#6">æ¡ä»¶åˆ¤æ–­</a></li>
  <li><a href="#7">å¾ªç¯è¯­å¥</a></li>
  <li><a href="#8">å‡½æ•°</a></li>
  <li><a href="#9">è¾“å…¥è¾“å‡º</a></li>
  <li><a href="#10">Shellè¿è¡Œæ§åˆ¶</a></li>
  <li><a href="#11">Wildcards</a></li>
  <li><a href="#12">Log&amp;Debug</a></li>
  <li><a href="#13">UNIXç¯å¢ƒ</a></li>
</ul>

<h2 id="1">OverView</h2>

<h3 id="å†å²å’Œç‰ˆæœ¬">å†å²å’Œç‰ˆæœ¬</h3>

<ul>
  <li>ç¬¬ä¸€ä¸ªï¼šThompson shell: Unix shell 1971@Bell Lab</li>
  <li>æ ‡å‡†çš„Unix Shell: Bourne shell 1978@Bell Lab</li>
  <li>Linuxå‘è¡Œç‰ˆçš„é»˜è®¤shell:bash shell(Bourne-Again shell)ï¼Œå…¶ä»–shellç±»å‹ï¼šash,korn,tcsh,zsh,dash</li>
  <li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä½¿ç”¨çš„Shell:<code class="highlighter-rouge">echo $SHELL</code></li>
  <li>
    <p>æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„shell: <code class="highlighter-rouge">cat /etc/shells </code></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /bin/bash
  /bin/csh
  /bin/ksh
  /bin/sh
  /bin/tcsh
  /bin/zsh
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="shellåˆ†ç±»">Shellåˆ†ç±»</h3>

<ul>
  <li>äº¤äº’å¼Shellï¼šåœ¨ç»ˆç«¯ä¸Šæ‰§è¡Œï¼Œshellç­‰å¾…ä½ çš„è¾“å…¥ï¼Œå¹¶ä¸”ç«‹å³æ‰§è¡Œä½ æäº¤çš„å‘½ä»¤ã€‚</li>
  <li>éäº¤äº’å¼Shellï¼šä»¥shell script(éäº¤äº’)æ–¹å¼æ‰§è¡Œã€‚åœ¨è¿™ç§æ¨¡å¼ ä¸‹ï¼Œshellä¸ä¸ä½ è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯è¯»å–å­˜æ”¾åœ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤,å¹¶ä¸”æ‰§è¡Œå®ƒä»¬ã€‚å½“å®ƒè¯»åˆ°æ–‡ä»¶çš„ç»“å°¾EOFï¼Œshellä¹Ÿå°±ç»ˆæ­¢äº†</li>
</ul>

<p>æŸ¥çœ‹æ˜¯å¦æ˜¯äº¤äº’å¼shellï¼Œå¯ä»¥é€šè¿‡æ‰“å°<code class="highlighter-rouge">$-</code>å˜é‡çš„å€¼ï¼ˆä»£è¡¨ç€å½“å‰shellçš„é€‰é¡¹æ ‡å¿—ï¼‰ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„â€œiâ€é€‰é¡¹ï¼ˆè¡¨ç¤ºinteractive shellï¼‰æ¥åŒºåˆ†äº¤äº’å¼ä¸éäº¤äº’å¼shellã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; echo $-
569JNRXZghiklms #äº¤äº’å¼

&gt; ./test.sh
echo $-
hB #éäº¤äº’å¼
</code></pre></div></div>

<p>æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if [[ -n $PS1 ]]; then
    : # These are executed only for interactive shells
    echo "interactive"
else
    : # Only for NON-interactive shells
fi
</code></pre></div></div>

<ul>
  <li>
    <p>ç™»å½•Shell: æ˜¯éœ€è¦ç”¨æˆ·åã€å¯†ç ç™»å½•åæ‰èƒ½è¿›å…¥çš„shellï¼ˆæˆ–è€…é€šè¿‡â€â€“loginâ€é€‰é¡¹ç”Ÿæˆçš„shellï¼‰ã€‚é€šè¿‡æ‰§è¡Œ<code class="highlighter-rouge">logout</code>æˆ–<code class="highlighter-rouge">exit</code>å‘½ä»¤é€€å‡ºshellã€‚bashæ˜¯ login shell æ—¶ï¼Œå…¶è¿›ç¨‹åä¸º<code class="highlighter-rouge">-bash</code> è€Œä¸æ˜¯<code class="highlighter-rouge">bash</code>ã€‚ å¯é€šè¿‡<code class="highlighter-rouge">echo $0</code>æŸ¥çœ‹</p>
  </li>
  <li>
    <p>éç™»å½•å¼Shell: ä¸éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å³å¯æ‰“å¼€çš„Shellï¼Œä¾‹å¦‚ï¼šç›´æ¥å‘½ä»¤â€œbashâ€å°±æ˜¯æ‰“å¼€ä¸€ä¸ªæ–°çš„éç™»å½•shellã€‚é€šè¿‡<code class="highlighter-rouge">exit</code>é€€å‡ºshellï¼Œbashæ˜¯élogin shell æ—¶ï¼Œå…¶è¿›ç¨‹åä¸º<code class="highlighter-rouge">/bin/bash</code> è€Œä¸æ˜¯<code class="highlighter-rouge">-bash</code>ã€‚ å¯é€šè¿‡<code class="highlighter-rouge">echo $0</code>æŸ¥çœ‹</p>
  </li>
</ul>

<p>æŸ¥çœ‹æ˜¯å¦æ˜¯login shellï¼ŒLINUXä¸‹å¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">shopt</code>å‘½ä»¤:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if shopt -q login_shell ; then
    : # These are executed only when it is a login shell
    echo "login"
else
    : # Only when it is NOT a login shell
    echo "nonlogin"
fi
</code></pre></div></div>

<p>æ³¨ï¼š<code class="highlighter-rouge">:</code> â€” è„šæœ¬ä¸­è¿™ä¸ªç¬¦å·æ²¡æœ‰æ„ä¹‰ï¼Œåªä¸ºäº†å¡«å……ç©ºè¡Œè€Œä½¿ç”¨</p>

<h3 id="shebang">Shebang</h3>
<ul>
  <li><code class="highlighter-rouge"><span class="c">#!/bin/bash</span></code></li>
  <li>å¦‚æœä¸æŒ‡å®š<code class="highlighter-rouge">shebang</code>ï¼Œç³»ç»Ÿç”¨é»˜è®¤çš„shell</li>
</ul>

<h2 id="2">å˜é‡</h2>

<ul>
  <li>ç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡</li>
  <li>ç³»ç»Ÿç¯å¢ƒå˜é‡
    <ul>
      <li>å±€éƒ¨ç¯å¢ƒå˜é‡</li>
      <li>å…¨å±€ç¯å¢ƒå˜é‡</li>
    </ul>
  </li>
</ul>

<h3 id="è‡ªå®šä¹‰å˜é‡è§„åˆ™">è‡ªå®šä¹‰å˜é‡è§„åˆ™</h3>

<ul>
  <li>åˆæ³•å­—ç¬¦ï¼Œæ•°å­—ï¼Œå­—æ¯ï¼Œä¸‹åˆ’çº¿</li>
  <li>&lt;= 20ä¸ªå­—ç¬¦</li>
  <li>å¤§å°å†™æ•æ„Ÿ</li>
  <li>å£°æ˜ï¼šå˜é‡å=å˜é‡å€¼ï¼Œ<strong>æ³¨æ„ç­‰å·å‰åæ²¡æœ‰ç©ºæ ¼ï¼Œå˜é‡åé€šå¸¸ç”¨å¤§å†™</strong> å¦‚<code class="highlighter-rouge">VAL=2</code></li>
  <li>è®¿é—®: <code class="highlighter-rouge">$VAL </code></li>
  <li>å˜é‡ä½¿ç”¨ï¼š
    <ul>
      <li>å¦‚æœå˜é‡åœ¨å•å¼•å·å†…åˆ™åŸå°ä¸åŠ¨çš„è¾“å‡º</li>
      <li>å¦‚æœå˜é‡åœ¨åŒå¼•å·å†…ï¼Œä½¿ç”¨<code class="highlighter-rouge">$VAL</code>æˆ–<code class="highlighter-rouge">${VAL}</code>ï¼Œè§£æå‡ºå˜é‡çš„å€¼è¾“å‡º</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; val="bash"
&gt; echo 'I like the $val shell' -&gt; I like the $val shell
&gt; echo "I like the $val shell" -&gt; I like the bash shell
&gt;  echo "I am ${val}ing on my keyboard" -&gt; I am bashing on my keyboard
</code></pre></div></div>
<ul>
  <li>ä½¿ç”¨åå¼•å·æˆ–è€…æ‹¬å·å°†å˜é‡çš„å†…å®¹è¿”å›</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; date
2007å¹´ 7æœˆ12æ—¥ æ˜ŸæœŸæ—¥ 16æ—¶48åˆ†21ç§’ CST
&gt; VAL=date
&gt; echo $VAL //è¾“å‡ºdate

//ä½¿ç”¨åå¼•å·: 
&gt; VAL=`date`
&gt; echo $val //è¾“å‡ºdateçš„å†…å®¹ï¼š2007å¹´ 7æœˆ12æ—¥ æ˜ŸæœŸæ—¥ 16æ—¶49åˆ†32ç§’ CST

//ä½¿ç”¨æ‹¬å·
&gt; VAL=$(date)
&gt; echo $val //è¾“å‡ºdateçš„å†…å®¹ï¼š2007å¹´ 7æœˆ12æ—¥ æ˜ŸæœŸæ—¥ 16æ—¶49åˆ†32ç§’ CST
</code></pre></div></div>
<ul>
  <li>æ ¼å¼åŒ–å­—ç¬¦ä¸²:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;var=`date +%Y%m%d`
&gt;echo $var //20150712
</code></pre></div></div>

<ul>
  <li>æ¥å—ç”¨æˆ·è¾“å…¥ä½œä¸ºå‚æ•°:<code class="highlighter-rouge">read -p "PROMPT" VARIABLE</code></li>
</ul>

<h2 id="3">å­—ç¬¦ä¸²æ“ä½œ</h2>

<ul>
  <li>å­—ç¬¦ä¸²é“¾æ¥</li>
  <li>å­—ç¬¦ä¸²é•¿åº¦</li>
  <li>æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä½ç½®</li>
  <li>å­—ç¬¦ä¸²æˆªæ–­</li>
  <li>å­—ç¬¦ä¸²åŒ¹é…</li>
</ul>

<h3 id="å­—ç¬¦ä¸²çš„è¿æ¥">å­—ç¬¦ä¸²çš„è¿æ¥</h3>

<ul>
  <li>å°†å­—ç¬¦ä¸²å†™åˆ°ä¸€èµ·å³å¯è¿æ¥å­—ç¬¦ä¸²</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;str=hello     
&gt;str1=world    
&gt;str=$str$str1
&gt;echo $str  --&gt; helloworld

&gt;str=$str" "$str1
&gt;echo $str --&gt; helloworld world
</code></pre></div></div>
<ul>
  <li>ä½¿ç”¨<code class="highlighter-rouge">""</code>åšå­—ç¬¦ä¸²æ‹¼æ¥</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>str="Test $str"
echo $str
Test hello:
</code></pre></div></div>

<h3 id="å­—ç¬¦ä¸²å¸¸ç”¨æ“ä½œ">å­—ç¬¦ä¸²å¸¸ç”¨æ“ä½œ</h3>

<ul>
  <li>æŸ¥çœ‹å­—ç¬¦ä¸²é•¿åº¦:<code class="highlighter-rouge">expr lenght "$str"</code></li>
  <li>æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­å­—ç¬¦ä½ç½®: <code class="highlighter-rouge">expr index $str CHARs</code>
    <ul>
      <li><code class="highlighter-rouge">expr index "abcd" 'b'</code>ç´¢å¼•ä»1å¼€å§‹</li>
    </ul>
  </li>
  <li>è·å–å­å­—ç¬¦ä¸²:<code class="highlighter-rouge">expr substr POS LENGTH</code>
    <ul>
      <li><code class="highlighter-rouge">expr substr "$str" 6 10</code></li>
    </ul>
  </li>
  <li>å­—ç¬¦ä¸²åŒ¹é…:
    <ul>
      <li><code class="highlighter-rouge">expr $str: REGEXP</code></li>
      <li><code class="highlighter-rouge">expr "$str" : '.*\([0-9]\{5\}\)'</code> åŒ¹é…<code class="highlighter-rouge">$str</code>ä¸­çš„æ•°å­—éƒ¨åˆ†ï¼Œé•¿åº¦ä¸º5ã€‚æ³¨æ„<code class="highlighter-rouge">:</code>å·¦å³è¦æ±‚æœ‰ç©ºæ ¼ï¼Œç‰¹æ®Šå­—ç¬¦è¦<code class="highlighter-rouge">\</code>è½¬ä¹‰ã€‚</li>
      <li><code class="highlighter-rouge">expr match $str REGXP</code></li>
    </ul>
  </li>
</ul>

<h2 id="4">æ•°å­¦è¿ç®—</h2>

<h3 id="é€»è¾‘è¿ç®—">é€»è¾‘è¿ç®—</h3>

<ul>
  <li><code class="highlighter-rouge">&amp; |  &lt; &gt; = != &lt;= &gt;=</code></li>
</ul>

<h3 id="æ•°å€¼è¿ç®—">æ•°å€¼è¿ç®—</h3>

<ul>
  <li><code class="highlighter-rouge">+ - * / % ()</code> å¾—åˆ°çš„ç»“æœéƒ½æ˜¯æ•´æ•°</li>
</ul>

<h3 id="è¿ç®—è¡¨è¾¾å¼">è¿ç®—è¡¨è¾¾å¼</h3>

<ul>
  <li><code class="highlighter-rouge">expr expression</code></li>
  <li><code class="highlighter-rouge">result=$[expression]</code></li>
</ul>

<p>ä¸»è¦ä½¿ç”¨ç¬¬äºŒç§</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; num1=7 
&gt; num2=13
&gt; num3=7
&gt; result=$[num1 &lt; 19]
&gt; echo $result --&gt; 1

&gt; result=$[num1 == num3] 
&gt; echo $result --&gt; 1
</code></pre></div></div>

<h2 id="5">æµ®ç‚¹è¿ç®—</h2>

<ul>
  <li>å†…å»ºè®¡ç®—å™¨bcï¼Œbcèƒ½å¤Ÿè¯†åˆ«ï¼š
    <ul>
      <li>æ•°å­—ï¼ˆæ•´å½¢ï¼Œæµ®ç‚¹å‹ï¼‰</li>
      <li>å˜é‡</li>
      <li>æ³¨é‡Šï¼ˆä»¥<code class="highlighter-rouge">#</code>å¼€å§‹çš„è¡Œï¼‰</li>
      <li>è¡¨è¾¾å¼</li>
      <li>ç¼–ç¨‹è¯­å¥ï¼ˆå¦‚æ¡ä»¶åˆ¤æ–­: <code class="highlighter-rouge">if-then-else</code>ï¼‰</li>
      <li>å‡½æ•°</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; bc
bc 1.06
Copyright 1991-1994, 1997, 1998, 2000 Free Software Foundation, Inc.
This is free software with ABSOLUTELY NO WARRANTY.
For details type `warranty'. 
12.5 * 0.3
3.7
100/3
33 //é»˜è®¤scale =0ï¼Œåˆ™æ²¡æœ‰å°æ•°ç‚¹åçš„ä½™æ•°
scale=4
100/3
33.3333

</code></pre></div></div>

<p>ä½¿ç”¨å˜é‡</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>num=12
num1=3;num2=4;
num1/num2
.7500

</code></pre></div></div>

<h3 id="è„šæœ¬ä¸­ä½¿ç”¨bc">è„šæœ¬ä¸­ä½¿ç”¨<code class="highlighter-rouge">bc</code></h3>

<ul>
  <li>ä½¿ç”¨ç®¡é“å‘½ä»¤ï¼Œç®¡é“å°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var <span class="o">=</span> <span class="sb">`</span><span class="nb">echo</span> <span class="s2">"options; expresssion"</span> | bc<span class="sb">`</span>
</code></pre></div></div>
<p>ä¸Šé¢çš„ä¾‹å­ï¼Œå°†<code class="highlighter-rouge">options;expression</code>ä½œä¸º<code class="highlighter-rouge">bc</code>çš„è¾“å…¥</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nv">var</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">"scale=4;3.44/5"</span> | bc<span class="sb">`</span>
<span class="o">&gt;</span> <span class="nb">echo</span> <span class="nv">$var</span>
.6880
</code></pre></div></div>

<ul>
  <li>ä½¿ç”¨ç®¡é“æ²¡æ³•è¿›è¡Œå¤æ‚çš„è¿ç®—ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨è¾“å…¥é‡å®šå‘:</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">result</span><span class="o">=</span><span class="sb">`</span>bc <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
options
statements
expressions
</span><span class="no">EOF
</span></code></pre></div></div>

<p>ä¾‹å¦‚ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nv">result</span><span class="o">=</span><span class="sb">`</span>bc <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
bquote&gt; scale=4
bquote&gt; var1=20
bquote&gt; var2=3
bquote&gt; var1/var2
bquote&gt; EOF
bquote&gt; `
&gt; echo </span><span class="nv">$result</span><span class="sh">
6.6666
</span></code></pre></div></div>

<h2 id="6">æ¡ä»¶åˆ¤æ–­</h2>

<ul>
  <li>æ¡ä»¶</li>
  <li>å¾ªç¯</li>
</ul>

<h3 id="if-thenè¯­å¥"><code class="highlighter-rouge">if-then</code>è¯­å¥</h3>

<ul>
  <li>å•æ¡ä»¶:</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="nb">command

</span><span class="k">then 
	</span>commands
<span class="k">elif
	</span>command2
<span class="k">then
	</span>commands
<span class="k">else
	</span>commands
<span class="k">fi</span>
</code></pre></div></div>

<p>å½“<code class="highlighter-rouge">if</code>åé¢çš„<code class="highlighter-rouge">command</code>è¿”å›<code class="highlighter-rouge">0</code>æ—¶ï¼Œæ‰§è¡Œ<code class="highlighter-rouge">then</code>åé¢çš„è¯­å¥:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="k">if </span><span class="nb">date
</span><span class="k">then
</span><span class="nb">echo</span> <span class="s2">"worked"</span>
<span class="k">fi</span>
</code></pre></div></div>

<h3 id="æ¡ä»¶åˆ¤æ–­">æ¡ä»¶åˆ¤æ–­</h3>

<ul>
  <li>ä¸‰ç±»æ¡ä»¶ï¼š
    <ul>
      <li>æ•°å€¼æ¯”è¾ƒ</li>
      <li>å­—ç¬¦ä¸²æ¯”è¾ƒ</li>
      <li>æ–‡ä»¶æ¯”è¾ƒ</li>
    </ul>
  </li>
  <li>ä½¿ç”¨<code class="highlighter-rouge">test</code>å‘½ä»¤</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if </span><span class="nb">test </span>condition
<span class="k">then
	</span>commands
<span class="k">fi</span>
</code></pre></div></div>
<ul>
  <li>ä½¿ç”¨<code class="highlighter-rouge">[]</code>ï¼Œæ³¨æ„conditionå‰åæœ‰ç©ºæ ¼</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> condition1 <span class="o">]</span>
<span class="k">then
	</span><span class="nb">command </span>N
<span class="k">elif</span> <span class="o">[</span> condition2 <span class="o">]</span>
<span class="k">then
	</span><span class="nb">command </span>Q
<span class="k">else
	</span><span class="nb">command </span>M
<span class="k">fi</span>
</code></pre></div></div>
<h3 id="å¸¸è§çš„æ¡ä»¶åˆ¤æ–­">å¸¸è§çš„æ¡ä»¶åˆ¤æ–­</h3>

<ul>
  <li>ä¸æˆ–:
    <ul>
      <li><code class="highlighter-rouge">[ condition1 ] &amp;&amp;[ condition2 ]</code></li>
      <li><code class="highlighter-rouge">[ condition1 ] || [ condition2 ]</code></li>
    </ul>
  </li>
  <li>æ•°å€¼æ¯”è¾ƒ
    <ul>
      <li>ç›¸ç­‰:<code class="highlighter-rouge">n1 -eq -n2</code></li>
      <li>å¤§äºï¼š<code class="highlighter-rouge">n1 -gt -n2</code></li>
      <li>å°äºï¼š<code class="highlighter-rouge">n1 -lt -n2</code></li>
      <li>å¤§äºç­‰äºï¼š<code class="highlighter-rouge">n1 -ge n2</code></li>
      <li>å°äºç­‰äºï¼š<code class="highlighter-rouge">n1 -le n2</code></li>
      <li>ä¸ç­‰äºï¼š<code class="highlighter-rouge">n1 -ne n2</code></li>
    </ul>
  </li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/sh</span>
<span class="nb">echo</span> <span class="s2">"input number: "</span>
<span class="nb">read </span>p
<span class="k">if</span> <span class="o">[</span> <span class="nv">$p</span> <span class="nt">-gt</span> 10 <span class="o">]</span>
<span class="k">then
 </span><span class="nb">echo</span> <span class="s2">"the number is greater than 10"</span>
<span class="k">fi
if</span> <span class="o">[</span> <span class="nv">$p</span> <span class="nt">-lt</span> 10 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$p</span> <span class="nt">-gt</span> 1 <span class="o">]</span>
<span class="k">then
 </span><span class="nb">echo</span> <span class="s2">"the number is less than 10 and greater than 1"</span>
<span class="k">fi</span>
</code></pre></div></div>
<ul>
  <li>å­—ç¬¦ä¸²æ¯”è¾ƒ:
    <ul>
      <li>ç›¸åŒ:<code class="highlighter-rouge">str1 = str2</code></li>
      <li>ä¸åŒï¼š<code class="highlighter-rouge">str1 != str2</code></li>
      <li>å¤§äºï¼š<code class="highlighter-rouge">str1 &gt; str2</code> //æ¯”è¾ƒascç </li>
      <li>å°äº: <code class="highlighter-rouge">str1 &lt; str2</code></li>
      <li>æ˜¯å¦é•¿åº¦é0: <code class="highlighter-rouge">-n str1</code></li>
      <li>æ˜¯å¦é•¿åº¦ä¸º0: <code class="highlighter-rouge">-z str1</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>

<span class="nv">str1</span><span class="o">=</span><span class="s2">"ab"</span>
<span class="nv">str2</span><span class="o">=</span><span class="s2">"bc"</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$str1</span> <span class="se">\&lt;</span> <span class="nv">$str2</span> <span class="o">]</span>//è½¬ä¹‰å­—ç¬¦
<span class="k">then
 </span><span class="nb">echo</span> <span class="s2">"str1 is less than str2"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nv">$str1</span> <span class="se">\&gt;</span> <span class="nv">$str2</span> <span class="o">]</span>
<span class="k">then
 </span><span class="nb">echo</span> <span class="s2">"str1 is greater than str2"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="nv">$str1</span> <span class="o">=</span> <span class="nv">$str2</span> <span class="o">]</span>
<span class="k">then
 </span><span class="nb">echo</span> <span class="s2">"str1 is equal to str2"</span>
<span class="k">fi</span>

</code></pre></div></div>

<ul>
  <li>æ–‡ä»¶æ¯”è¾ƒ
    <ul>
      <li>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”åœ¨åŒä¸€ä¸ªç›®å½•: <code class="highlighter-rouge">-d file</code></li>
      <li>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨: <code class="highlighter-rouge">-e file</code></li>
      <li>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶: <code class="highlighter-rouge">-f file</code></li>
      <li>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨ï¼Œå¹¶éç©º: <code class="highlighter-rouge">-s file</code></li>
      <li>
        <p>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦æ˜¯å¯æ‰§è¡Œæ–‡ä»¶: <code class="highlighter-rouge">-x file</code></p>
      </li>
      <li>æ£€æŸ¥file1æ¯”file2æ–°ï¼š<code class="highlighter-rouge">file1 -nt file2</code></li>
      <li>æ£€æŸ¥file1æ¯”file2æ—§ï¼š<code class="highlighter-rouge">file1 -ot file2</code></li>
    </ul>
  </li>
  <li>
    <p>é«˜çº§åˆ¤æ–­</p>

    <ul>
      <li><code class="highlighter-rouge">(( expression ))</code> é«˜çº§æ•°å­¦è¡¨è¾¾å¼</li>
      <li><code class="highlighter-rouge">[[ expression ]]</code> é«˜çº§å­—ç¬¦ä¸²æ¯”è¾ƒ, æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>

<span class="nv">val1</span><span class="o">=</span>10

<span class="k">if</span> <span class="o">((</span> <span class="nv">$val1</span> <span class="k">**</span> 2 <span class="o">&gt;</span> 90 <span class="o">))</span>
<span class="k">then</span>
	<span class="o">((</span> val2 <span class="o">=</span> <span class="nv">$val1</span> <span class="k">**</span> 2<span class="o">))</span>
	<span class="nb">echo</span> <span class="s2">"The square of </span><span class="nv">$val1</span><span class="s2"> is </span><span class="nv">$val2</span><span class="s2">"</span>
<span class="k">fi</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$USER</span> <span class="o">==</span> m<span class="k">*</span> <span class="o">]]</span>
<span class="k">then
</span>ehco <span class="s2">"The current use is </span><span class="nv">$USER</span><span class="s2">"</span>
<span class="k">fi</span>


</code></pre></div></div>

<h3 id="caseè¯­å¥">caseè¯­å¥</h3>

<ul>
  <li>caseè¯­æ³•</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
case "$VAR" in 
	pattern_1)
		# Commands go here
		;;
	pattern_N) 
		# commands go here
		;;

	*) # default case
		# commands go here
	 	;;
esac

</code></pre></div></div>

<ul>
  <li>ä½¿ç”¨æ•°å­—</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>
<span class="nb">echo</span> <span class="s2">"input a number: "</span>
<span class="nb">read </span>num

<span class="k">case</span> <span class="nv">$num</span> <span class="k">in
</span>1<span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"The month is January"</span><span class="p">;;</span>
2<span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"The month is Feb"</span><span class="p">;;</span>
<span class="k">*</span><span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"The month is unknown"</span><span class="p">;;</span>
<span class="k">esac</span>

</code></pre></div></div>

<ul>
  <li>ä½¿ç”¨å­—ç¬¦ä¸²</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>
<span class="nb">echo</span> <span class="s2">"input YES|NO: "</span>
<span class="nb">read </span>var

<span class="k">case</span> <span class="nv">$var</span> <span class="k">in

</span>YES <span class="p">|</span> <span class="nb">yes</span> <span class="p">|</span> y <span class="p">|</span> Y<span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"You said YES"</span>
 <span class="nb">echo</span> <span class="s2">"OK!"</span>
 <span class="p">;;</span>

NO <span class="p">|</span> n <span class="p">|</span> N <span class="p">|</span> no<span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"You said NO"</span><span class="p">;;</span>
<span class="k">*</span><span class="p">)</span>
 <span class="nb">echo</span> <span class="s2">"The input is unknown"</span><span class="p">;;</span>
<span class="k">esac</span>  
  
</code></pre></div></div>

<h2 id="7">å¾ªç¯</h2>

<ul>
  <li><code class="highlighter-rouge">for,while,until,break,continue</code></li>
</ul>

<h3 id="forå¾ªç¯">forå¾ªç¯</h3>

<ul>
  <li>è¯­æ³•1ï¼šå°†listä¸­çš„æ¯ä¸€é¡¹èµ‹å€¼ç»™val</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
for VARIABLE_NAME in ITEM_1 ITEM_N
do
	command 1
	command 2
	command N
done

</code></pre></div></div>

<ul>
  <li>demo1:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>
<span class="k">for </span>COLOR <span class="k">in </span>red green blue
<span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"COLOR: </span><span class="nv">$COLOR</span><span class="s2">"</span>
<span class="k">done</span>

<span class="nt">--------------------</span>
output:

<span class="o">&gt;</span> COLOR:red
<span class="o">&gt;</span> COLOR:green
<span class="o">&gt;</span> COLOR:blue

</code></pre></div></div>

<ul>
  <li>demo2:é‡å‘½åå½“å‰ç›®å½•ä¸‹çš„å›¾ç‰‡</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>

<span class="nv">PICTURES</span><span class="o">=</span><span class="si">$(</span><span class="nb">ls</span> <span class="k">*</span>jpeg<span class="si">)</span>
<span class="nv">DATE</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%F<span class="si">)</span>

<span class="k">for </span>PICTURE <span class="k">in</span> <span class="nv">$PICTURES</span>
<span class="k">do
   </span><span class="nb">echo</span> <span class="s2">"Renaming </span><span class="k">${</span><span class="nv">PICTURE</span><span class="k">}</span><span class="s2"> to </span><span class="k">${</span><span class="nv">DATE</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">PICTURE</span><span class="k">}</span><span class="s2">"</span>
   <span class="nb">mv</span> <span class="k">${</span><span class="nv">PICTURE</span><span class="k">}</span> <span class="k">${</span><span class="nv">DATE</span><span class="k">}</span>-<span class="k">${</span><span class="nv">PICTURE</span><span class="k">}</span>
<span class="k">done</span>

</code></pre></div></div>

<ul>
  <li>è¯­æ³•2ï¼šä½¿ç”¨<code class="highlighter-rouge">((...))</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
for(( i=1; i&lt;10; i++))
do 
	commands
done

</code></pre></div></div>

<h3 id="listæ¥æº">listæ¥æº</h3>

<ul>
  <li>ç›´æ¥åˆ›å»ºåˆ—è¡¨</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
for val in Jan Feb Mar Apr May
do
  echo "month name is $val"
done

</code></pre></div></div>
<ul>
  <li>ä»å˜é‡è¯»å–</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
list="Jan Feb Mar Apr May"
for val in $list
do
  echo "Month name is $val"
  done

</code></pre></div></div>
<ul>
  <li>ä»å‘½ä»¤è¯»å–</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
for val in `cat monthlist`
do
  echo "Month name is $val"
done

</code></pre></div></div>
<ul>
  <li>ä»ç›®å½•è¯»å–</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
#æ–‡ä»¶é€šé…ç¬¦
for val in ~/Documents/Coding/Shell/*
do
echo "$val"
done  
   
</code></pre></div></div>

<h3 id="shellä¸­é»˜è®¤çš„åˆ†éš”ç¬¦">shellä¸­é»˜è®¤çš„åˆ†éš”ç¬¦</h3>

<ul>
  <li>ç©ºæ ¼</li>
  <li>åˆ¶è¡¨ç¬¦</li>
  <li>æ¢è¡Œç¬¦</li>
  <li>
    <p>ä¿®æ”¹åˆ†éš”ç¬¦</p>

    <ul>
      <li><code class="highlighter-rouge">IFS=$";"</code> ä»¥åˆ†å·åˆ†å‰²</li>
    </ul>
  </li>
</ul>

<h3 id="whileå’Œuntil">whileå’Œuntil</h3>

<ul>
  <li>whileè¯­æ³•</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
while [ CONDITION_IS_TRUE ] command
do
	command 1
	command 2
	command N
done

</code></pre></div></div>

<ul>
  <li>example:loop 9 times</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
#loop 9times

val=1
while [ $val -lt 10 ]
do
	echo "$val"
	val=$[ $val+1 ] # ((val++))
done

</code></pre></div></div>

<ul>
  <li>exmpel: read input</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
while [ "$CORRECT" != "y" ]
do 
	read -p "Enter your name:"  NAME
	read -p "Is ${NAME} correct? " CORRECT
end

</code></pre></div></div>

<ul>
  <li>example: Reading a file, line by line</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
LINE_NUM=1
while read LINE
do
	echo "${LINE_NUM}: ${LINE}"
	((LINE_NUM++))
done &lt; /etc/fstab

FS_NUM=1
grep xfs /etc/fstab | while read LINE do #è¯»xfsæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œ
	echo "xfs: ${LINE}"
end

FS_NUM=1
grep xfs /etc/fstab | while read FS MP REST #è¯»xfsï¼Œç¬¬ä¸€è¡Œæ”¾å…¥FSå˜é‡ï¼Œç¬¬äºŒè¡Œæ”¾å…¥MPï¼Œå…¶å®ƒè¡Œæ”¾å…¥REST
do
	echo "${FS_NUM}: file system: ${FS}"
	echo "${FS_NUM}: mount point: ${MP}"
	((FS_NUM++))
done 

</code></pre></div></div>

<ul>
  <li>ä½¿ç”¨continue</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
mysql -Bne 'show databases' | while read DB
do
	db-backed-up-recently $DB
	if [ "$?" -eq "0" ]
	then
		continue
	fi
		backup $DB
done
 
</code></pre></div></div>

<ul>
  <li>untilè¯­æ³•</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
until [ CONDITION_IS_TRUE ] command
do
	command
done

</code></pre></div></div>

<ul>
  <li>example</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
val=1
util [ $val -eq 10 ]
do
echo "$val"
val=$[ $val+1 ]
done

</code></pre></div></div>

<h2 id="8">å‡½æ•°</h2>

<h3 id="å®šä¹‰">å®šä¹‰</h3>

<ul>
  <li>å®šä¹‰1:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
function name {
	commands
}

</code></pre></div></div>

<ul>
  <li>å®šä¹‰2</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
name() {
	commands
}

</code></pre></div></div>

<ul>
  <li>å‡½æ•°è°ƒç”¨</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>

<span class="k">function </span>hello<span class="o">(){</span>
	<span class="nb">echo</span> <span class="s2">"HELLO!"</span>
	now <span class="c">#å‡½æ•°è°ƒç”¨</span>
<span class="o">}</span>

<span class="c">#hello #é”™è¯¯ï¼Œå› ä¸ºnowè¿˜æ²¡è¢«å£°æ˜</span>

<span class="k">function </span>now<span class="o">(){</span>
	<span class="nb">echo</span> <span class="s2">"It's </span><span class="si">$(</span><span class="nb">date</span>+%r<span class="si">)</span><span class="s2">"</span>
<span class="o">}</span>

hello <span class="c">#æ­£ç¡®ï¼Œå‡½æ•°è°ƒç”¨ï¼Œæ²¡æœ‰æ‹¬å·</span>

</code></pre></div></div>
<ul>
  <li>å‡½æ•°å‚æ•°ä¼ é€’:
    <ul>
      <li>å¼•ç”¨å‘½ä»¤è¡Œå‚æ•°åšå˜é‡ï¼š<code class="highlighter-rouge">&gt; script.sh parm1 param2 param3</code>åœ¨è„šæœ¬é‡Œæ€ä¹ˆè®¿é—®
        <ul>
          <li>æ‰€æœ‰å‚æ•° <code class="highlighter-rouge">$@</code></li>
          <li>å‚æ•°ä¸ªæ•° <code class="highlighter-rouge">$#</code></li>
          <li>ç¬¬1ä¸ªå‚æ•° <code class="highlighter-rouge">$1</code></li>
          <li>ç¬¬2ä¸ªå‚æ•° <code class="highlighter-rouge">$2</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>example1:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
#! /bash/bin

function hello(){
	echo "Hello $1"
}

hello Jason

#Output : Hello Jason

</code></pre></div></div>

<ul>
  <li>example2:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s2">"Excuting script: </span><span class="nv">$0</span><span class="s2">"</span>
<span class="k">for </span>USER <span class="k">in</span> <span class="nv">$@</span> <span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"Achiving user: </span><span class="nv">$USER</span><span class="s2">"</span>
	<span class="c">#lock the account</span>
	passwd <span class="nt">-l</span> <span class="nv">$USER</span>
	<span class="c">#create an achive of the home dir</span>
	<span class="nb">tar </span>cf /archives/<span class="k">${</span><span class="nv">USER</span><span class="k">}</span>.tar.gz /home/<span class="k">${</span><span class="nv">USER</span><span class="k">}</span>
end

</code></pre></div></div>

<ul>
  <li>å‡½æ•°çš„å˜é‡
    <ul>
      <li>å…¨å±€å˜é‡: é»˜è®¤å˜é‡éƒ½æ˜¯å…¨å±€çš„</li>
      <li>å±€éƒ¨å˜é‡: åªèƒ½åœ¨å‡½æ•°å†…è®¿é—®çš„å˜é‡ï¼Œå˜é‡å‰åŠ <code class="highlighter-rouge">local</code>ï¼Œåªæœ‰å‡½æ•°èƒ½ä½¿ç”¨local variableã€‚</li>
      <li>å®šä¹‰åœ¨å‡½æ•°é‡Œçš„å˜é‡ï¼Œåªæœ‰å½“å‡½æ•°è¢«æ‰§è¡Œåï¼Œå˜é‡æ‰å˜æˆå…¨å±€çš„</li>
    </ul>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	
  <span class="c">#!/bin/bash</span>
	
  my_function<span class="o">(){</span>
      <span class="nv">GLOBAL_VAR</span><span class="o">=</span>1
  <span class="o">}</span>
  <span class="c">#GLOBAL_VAR not available yet.</span>
  <span class="nb">echo</span> <span class="nv">$GLOBAL_VAR</span>
  my_function
  <span class="c">#GLOBAL_VAR is NOW available. </span>
  <span class="nb">echo</span> <span class="nv">$GLOBAL_VAR</span>
	
</code></pre></div>    </div>
  </li>
  <li>è¡Œæ•°è¿”å›å€¼
    <ul>
      <li>æ˜¾å¼æŒ‡å®šï¼š<code class="highlighter-rouge">return &lt;RETURN CODE&gt;</code>
        <ul>
          <li>0ï¼šsuccess</li>
        </ul>
      </li>
      <li>é»˜è®¤ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœ</li>
      <li>example:</li>
    </ul>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	
  function backup_file(){
      if [ -f $1 ]
      then
          local BACK="/tmp/$(basename ${1}).$(date +%F).$$" #$$ä»£è¡¨å½“å‰running scriptçš„PID
          echo "Backing up $1 to ${BACK}"
          cp $1 $BACK
      else
          return 1
      fi
  }
  backup_file /etc/hosts
  if [ $? -eq 0 ]
  then
      echo "Backup succeeded!"
  else
      echo "Backup failed"
      exit 1
  fi
	
</code></pre></div>    </div>
  </li>
  <li>å¼•ç”¨å…¶å®ƒè„šæœ¬ä¸­çš„å‡½æ•°
    <ul>
      <li><code class="highlighter-rouge">source filepath</code>æˆ–è€…<code class="highlighter-rouge">. filepath</code></li>
    </ul>
  </li>
</ul>

<h2 id="9">è¾“å…¥è¾“å‡º</h2>

<h3 id="è¾“å…¥è¾“å‡ºé‡å®šå‘">è¾“å…¥è¾“å‡ºé‡å®šå‘</h3>

<ul>
  <li>è¾“å‡ºé‡å®šå‘:  å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­
    <ul>
      <li><code class="highlighter-rouge">command &gt; outputfile</code> //ä¼šè¦†ç›–åŸæ•°æ®</li>
      <li><code class="highlighter-rouge">command &gt;&gt; outputfile</code> //ä¼šè¿½åŠ æ–°æ•°æ®åˆ°è€æ•°æ®åé¢</li>
    </ul>
  </li>
  <li>è¾“å…¥é‡å®šå‘: å°†æ–‡ä»¶å†…å®¹è¾“å…¥ç»™å‘½ä»¤
    <ul>
      <li><code class="highlighter-rouge">command &lt; outputfile</code></li>
    </ul>
  </li>
  <li>å†…è”è¾“å…¥é‡å®šå‘</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>command &lt;&lt; marker

data input

marker
</code></pre></div></div>

<p>ä¾‹å¦‚ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;  Shell  result=`bc &lt;&lt; EOF 
bquote&gt; var1=3
bquote&gt; var2=5
bquote&gt; var3=var1+var2
bquote&gt; print var3
bquote&gt; EOF
bquote&gt; `
&gt; Shell  echo $result
8
</code></pre></div></div>

<h3 id="æ–‡ä»¶æè¿°ç¬¦ä¸é”™è¯¯é‡å®šå‘">æ–‡ä»¶æè¿°ç¬¦ä¸é”™è¯¯é‡å®šå‘</h3>

<p>æ¯ä¸ªè¿›ç¨‹éƒ½å’Œä¸‰ä¸ªç³»ç»Ÿæ–‡ä»¶ ç›¸å…³è”ï¼šæ ‡å‡†è¾“å…¥stdinï¼Œæ ‡å‡†è¾“å‡ºstdoutã€æ ‡å‡†é”™è¯¯stderrï¼Œä¸‰ä¸ªç³»ç»Ÿæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦åˆ†åˆ«ä¸º0ï¼Œ1ã€2</p>

<table>
  <thead>
    <tr>
      <th>æ–‡ä»¶æè¿°ç¬¦</th>
      <th>ç¼©å†™</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>STDIN</td>
      <td>æ ‡å‡†è¾“å…¥</td>
    </tr>
    <tr>
      <td>1</td>
      <td>STDOUT</td>
      <td>æ ‡å‡†è¾“å‡º</td>
    </tr>
    <tr>
      <td>2</td>
      <td>STDERR</td>
      <td>æ ‡å‡†é”™è¯¯</td>
    </tr>
  </tbody>
</table>

<p>å°†é”™è¯¯ä¿å­˜åˆ°logä¸­:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;cat iot 2 &gt; errlog

</code></pre></div></div>

<ul>
  <li>ä¸´æ—¶é‡å®šå‘:å°†shellè„šæœ¬ä¸­çš„é”™è¯¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­:<code class="highlighter-rouge">command &gt;&amp; æ–‡ä»¶æè¿°ç¬¦</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/sh</span>

<span class="nb">echo</span> <span class="s2">"Test Error"</span> <span class="o">&gt;</span>&amp; 2
<span class="nb">echo</span> <span class="s2">"Normal output"</span>

</code></pre></div></div>

<p>æ‰§è¡Œè„šæœ¬ï¼Œé”™è¯¯ä¼šæ‰“å°åœ¨å‘½ä»¤è¡Œä¸­ï¼ŒåŸå› æ˜¯consoleæ˜¯é»˜è®¤çš„é”™è¯¯è¾“å‡ºã€‚å¦‚æœè¦å°†shellä¸­äº§ç”Ÿçš„é”™è¯¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œæ‰§è¡Œshellçš„æ—¶å€™è¦è¿½åŠ é‡å®šå‘ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;  ./iotest 2&gt;&gt; errlog

</code></pre></div></div>

<ul>
  <li>ç†è§£/dev/null</li>
</ul>

<p>åœ¨ç±»Unixç³»ç»Ÿä¸­ï¼Œ<code class="highlighter-rouge">/dev/null</code>ï¼Œæˆ–ç§°ç©ºè®¾å¤‡ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è®¾å¤‡æ–‡ä»¶ï¼Œå®ƒä¸¢å¼ƒä¸€åˆ‡å†™å…¥å…¶ä¸­çš„æ•°æ®ï¼Œè¯»å–å®ƒåˆ™ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ª<code class="highlighter-rouge">EOF</code>ã€‚ å› æ­¤<code class="highlighter-rouge">/dev/null</code>ä¹Ÿè¢«ç§°ä¸ºé»‘æ´ã€‚shellè„šæœ¬ä¸­ä¸€ç§å¸¸è§çš„å†™æ³•æ˜¯<code class="highlighter-rouge">command &gt;/dev/null 2&gt;&amp;1</code>ï¼Œå®ƒæ˜¯ä¸€ç§å½“å°†commandå‘½ä»¤çš„è¾“å‡ºæˆ–è€…é”™è¯¯é‡å®šå‘åˆ°é»‘æ´é‡Œåšæ³•ï¼Œæ‰€ä»¥è¿™é‡Œ2&gt;&amp;1 çš„æ„æ€å°±æ˜¯å°†æ ‡å‡†é”™è¯¯ä¹Ÿè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå½“ä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼šï¼›</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;cat test.sh
t
date

&gt; ./test.sh &gt; test1.log
&gt; ./test.sh: line 1: t: command not found

&gt; cat test1.log
Wed Jul 10 21:12:02 CST 2007
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œdateçš„æ‰§è¡Œç»“æœè¢«é‡å®šå‘åˆ°logæ–‡ä»¶ä¸­äº†ï¼Œè€Œtæ— æ³•æ‰§è¡Œçš„é”™è¯¯åˆ™åªæ‰“å°åœ¨å±å¹•ä¸Šã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; ./test.sh &gt; test2.log 2&gt;&amp;1

&gt; cat test2.log
./test.sh: line 1: t: command not found
Tue Oct 9 20:53:44 CST 2007

</code></pre></div></div>

<p>è¿™æ¬¡ï¼Œstderrå’Œstdoutçš„å†…å®¹éƒ½è¢«é‡å®šå‘åˆ°logæ–‡ä»¶ä¸­äº†ã€‚</p>

<ul>
  <li>æ°¸ä¹…é‡å®šå‘: <code class="highlighter-rouge">exec æ–‡ä»¶æè¿°ç¬¦&gt;æ–‡ä»¶å</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#! /bin/sh</span>

<span class="nb">exec </span>1&gt;output
<span class="nb">exec </span>2&gt;errlog

<span class="nb">echo</span> <span class="s2">"Test Error"</span> <span class="o">&gt;</span>&amp; 2
<span class="nb">echo</span> <span class="s2">"Normal output"</span>

</code></pre></div></div>

<p>è¿™æ ·ï¼Œè¾“å…¥è¾“å‡ºéƒ½å›é‡å®šå‘åˆ°æ–‡ä»¶ä¸­</p>

<h3 id="ç®¡é“">ç®¡é“</h3>

<p>å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼Œé‡å®šå‘åˆ°å¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥:<code class="highlighter-rouge">command1 | command2</code></p>

<ul>
  <li>å°†å½“å‰è¿›ç¨‹ä»¥ç¿»é¡µçš„å½¢å¼æŸ¥çœ‹:<code class="highlighter-rouge">ps -ef | less</code></li>
  <li>æŸ¥æ‰¾å½“å‰è¿›ç¨‹ä¸­çš„æŸä¸ªè¿›ç¨‹:<code class="highlighter-rouge">ps -ef | grep bash</code></li>
</ul>

<h2 id="10">Shellè¿è¡Œæ§åˆ¶</h2>

<h3 id="linuxä¸­çš„ä¿¡å·">Linuxä¸­çš„ä¿¡å·</h3>

<ul>
  <li>ä»€ä¹ˆæ˜¯ä¿¡å·
    <ul>
      <li>è½¯ä¸­æ–­</li>
      <li>è¿›ç¨‹é—´å¼‚æ­¥é€šä¿¡</li>
      <li><code class="highlighter-rouge">man signal</code></li>
    </ul>
  </li>
  <li>äº§ç”Ÿä¿¡å·
    <ul>
      <li>ç»ˆæ­¢è¿›ç¨‹:<code class="highlighter-rouge">SIGINT</code>: CTRL+C</li>
      <li>æš‚åœè¿›ç¨‹:<code class="highlighter-rouge">SIGSTP</code>:CTRL+Z</li>
      <li><code class="highlighter-rouge">kill</code>/<code class="highlighter-rouge">kill all</code>
        <ul>
          <li><code class="highlighter-rouge">kill -9</code>: <code class="highlighter-rouge">9</code>æ˜¯<code class="highlighter-rouge">SIGKILL</code>ï¼Œæ— æ¡ä»¶ç»ˆæ­¢è¿›ç¨‹</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>å¤„ç†ä¿¡å·
    <ul>
      <li>ç³»ç»Ÿé»˜è®¤æ–¹å¼å¤„ç†</li>
      <li>å¿½ç•¥ä¿¡å·</li>
      <li>è‡ªå®šä¹‰å¤„ç†ä¿¡å·çš„æ–¹æ³•
        <ul>
          <li>ä½¿ç”¨<code class="highlighter-rouge">trap</code>æ•è·SIGINTï¼š<code class="highlighter-rouge">trap "echo 'Signal Trapped SIGINT for ctrl+C'" SIGINT</code></li>
          <li>ç§»é™¤æ·»åŠ çš„<code class="highlighter-rouge">trap</code>ï¼š<code class="highlighter-rouge">trap - SIGINT</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="åå°è¿è¡Œçš„è„šæœ¬">åå°è¿è¡Œçš„è„šæœ¬</h3>

<ul>
  <li>å‘½ä»¤æ ¼å¼:	<code class="highlighter-rouge">SCRIPT &amp;</code>ã€‚
    <ul>
      <li>ä¾‹å¦‚:<code class="highlighter-rouge">./bgtest &amp;</code>ï¼šå°†è„šæœ¬åœ¨åå°è¿è¡Œ</li>
      <li>æŸ¥çœ‹æ‰€æœ‰è¿è¡Œä¸­çš„ä½œä¸š:<code class="highlighter-rouge">jobs</code></li>
      <li>åœ¨å‰å°é‡å¯åœæ­¢çš„ä½œä¸š:<code class="highlighter-rouge">fg ä½œä¸šå·</code>
        <ul>
          <li>ä¾‹å¦‚:<code class="highlighter-rouge">fg 1</code></li>
        </ul>
      </li>
      <li>åœ¨åå°é‡å¯åœæ­¢çš„ä½œä¸š:<code class="highlighter-rouge">fg ä½œä¸šå·</code>
        <ul>
          <li>ä¾‹å¦‚:<code class="highlighter-rouge">bg 1</code></li>
        </ul>
      </li>
      <li>ä½œä¸šä¼˜å…ˆçº§: -20(é«˜) ~ +19ï¼ˆä½ï¼‰</li>
      <li>è®¾å®šä¼˜å…ˆçº§:<code class="highlighter-rouge">nice</code>
        <ul>
          <li><code class="highlighter-rouge">nice -n 10 ./bgtest &amp;</code></li>
        </ul>
      </li>
      <li>é‡æ–°è®¾å®šä¼˜å…ˆçº§:<code class="highlighter-rouge">renice</code>
        <ul>
          <li><code class="highlighter-rouge">renice 10 -p pid</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ä½¿ç”¨<code class="highlighter-rouge">nohub SCRIPT &amp;</code>ï¼šå½“bashçª—å£é€€å‡ºæ—¶ï¼Œä¸ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ</li>
</ul>

<h3 id="é€€å‡ºç ">é€€å‡ºç </h3>

<ul>
  <li>é€€å‡ºç :<code class="highlighter-rouge">$?</code>
    <ul>
      <li>é»˜è®¤å€¼ä¸ºä¸Šä¸€æ¡å‘½ä»¤çš„è¿”å›å€¼</li>
      <li>æŸ¥çœ‹å‘½ä»¤çš„è¿”å›å€¼ï¼š<code class="highlighter-rouge">man command</code></li>
      <li>example: <code class="highlighter-rouge">&gt; ls -al ; echo $?</code></li>
    </ul>
  </li>
  <li>return è¿”å›å€¼
    <ul>
      <li>èŒƒå›´ï¼š0~255</li>
      <li>0ï¼šæˆåŠŸ</li>
      <li>é0ï¼šå¤±è´¥</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
HOST="google.com"
ping -c 1 $HOST
if[ "$?" -eq "0" ]
then
	echo "$HOST reachabe."
else
	echo "$HOST unreachable."
fi

</code></pre></div></div>

<ul>
  <li>è‡ªå®šä¹‰é€€å‡ºç </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
HOST="google.com"
ping -c 1 $ HOST
if[ "$?" -ne "0"]
then
	echo "$HOST unreachable"
	exit 1 #è‡ªå®šä¹‰é€€å‡ºç 
fi
exit0

</code></pre></div></div>

<ul>
  <li>ä¸²è”å‘½ä»¤
    <ul>
      <li>ä½¿ç”¨<code class="highlighter-rouge">;</code>ï¼Œä¸ç®¡å‘½ä»¤è¿”å›å€¼ï¼Œé¡ºåºæ‰§è¡Œ
        <ul>
          <li><code class="highlighter-rouge">&gt; cp test.txt /tmp/bak/ ; cp test.txt /tmp</code></li>
        </ul>
      </li>
      <li>ä½¿ç”¨<code class="highlighter-rouge">&amp;&amp;</code>å’Œ<code class="highlighter-rouge">||</code>ï¼Œåä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œä¾èµ–å‰ä¸€æ¡æŒ‡ä»¤çš„ç»“æœ
        <ul>
          <li><code class="highlighter-rouge">&amp;&amp;</code>ï¼šå‰ä¸€æ¡æ‰§è¡ŒæˆåŠŸåï¼Œåé¢æ‰æ‰§è¡Œï¼š<code class="highlighter-rouge">&gt; mkdir /tmp/bak &amp;&amp; cp test.txt /tmp/bak/</code></li>
          <li><code class="highlighter-rouge">||</code>ï¼šå‰ä¸€æ¡æ‰§è¡ŒæˆåŠŸåï¼Œåé¢è¯­å¥ä¸æ‰§è¡Œ: <code class="highlighter-rouge">&gt; ping -c 1 "google.com" || echo "not reachable" </code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="11"> Wildcards </h2>

<ul>
  <li>A character or string used for pattern matching
    <ul>
      <li>Globbing expands the wildcard pattern into a list of files and directories</li>
      <li>Wildcards can be used with most commands</li>
      <li>ls,rm,cp</li>
    </ul>
  </li>
  <li>Wildcards
    <ul>
      <li><code class="highlighter-rouge">*</code> matches zero or more characters
        <ul>
          <li>*.txt //æ‰€æœ‰txtç»“å°¾çš„</li>
          <li>a* //aå¼€å¤´çš„æ–‡ä»¶</li>
          <li>a*.txt //aå¼€å¤´çš„txtæ–‡ä»¶</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">?</code> matches exactly one character
        <ul>
          <li>?.txt //åŒ¹é…åªæœ‰ä¸€ä¸ªå­—æ¯åšæ–‡ä»¶åçš„txt</li>
          <li>a? //</li>
          <li>a?.txt</li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">[]</code> A character class
        <ul>
          <li>åŒ¹é…æ‹¬å·é‡Œçš„å­—ç¬¦ï¼ŒåªåŒ¹é…ä¸€ä¸ªå¤«å¦‡</li>
          <li>ca[nt]* åŒ¹é…caå¼€å¤´ï¼Œç¬¬ä¸‰ä¸ªå­—æ¯æ˜¯næˆ–è€…tçš„å•è¯
            <ul>
              <li>can</li>
              <li>cat</li>
              <li>candy</li>
              <li>catch</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">[!]</code> åŒ¹é…æ‰€æœ‰ä¸ä»¥æ‹¬å·å†…å¼€å¤´çš„å•è¯ï¼ŒåªåŒ¹é…ä¸€ä¸ªå­—ç¬¦
        <ul>
          <li>[!aeiou]* ä¸ä»¥å…ƒéŸ³å¼€å¤´
            <ul>
              <li>basketball</li>
              <li>cricket</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">[-]</code> åŒ¹é…èŒƒå›´ï¼Œé€šè¿‡ä¸­åˆ’çº¿æ ‡è®°èŒƒå›´
        <ul>
          <li>[a-g]* åŒ¹é…æ‰€æœ‰ä»¥a-gå¼€å¤´çš„æ–‡ä»¶</li>
          <li>[3-6]* åŒ¹é…æ‰€æœ‰3-6æ•°å­—ä¹‹é—´å¼€å¤´çš„æ–‡ä»¶</li>
          <li>ç³»ç»Ÿæ”¯æŒçš„åŒ¹é…æ ¼å¼ï¼š
            <ul>
              <li>[[:alpha:]] åŒ¹é…æ‰€æœ‰å¤§å°å†™å­—æ¯</li>
              <li>[[:alnum:]] åŒ¹é…æ‰€æœ‰å¤§å°å†™å­—æ¯+æ•°å­—</li>
              <li>[[:digit:]] åŒ¹é…æ•°å­—</li>
              <li>[[:lower:]] åŒ¹é…å°å†™å­—æ¯</li>
              <li>[[:space:]] åŒ¹é…ç©ºæ ¼</li>
              <li>[[:upper:]] åŒ¹é…å¤§å†™å­—æ¯</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="12"> Logs </h2>

<h3 id="syslog">Syslog</h3>

<ul>
  <li>The syslog standard uses facilities and serverities to categorize messages
    <ul>
      <li>Facilities: kern, user, mail, daemon, auth, local0, local7</li>
      <li>Serverities: emerg, alert, crit, err, warning, notice, info,debug</li>
    </ul>
  </li>
  <li>Log file locations are configurable
    <ul>
      <li>/var/log/messages</li>
      <li>/var/log/syslog</li>
    </ul>
  </li>
</ul>

<h3 id="logging-with-logger">Logging with logger</h3>
<ul>
  <li>The logger utility</li>
  <li>By default creates user.notice messages.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
logger "Message"
logger -p local10.info "Message"
logger -t myscript -p local10.info "Message"
logger -i -t myscript "Message"

</code></pre></div></div>

<ul>
  <li>example</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
logit(){
	local LOG_LEVEL=$1
	shift
	MSG=$@
	TIMESTAMP=$(date +"%Y-%m-%d %T")
	if[ $LOG_LEVEL = 'ERROR' ] || $VERBOSE 
	then
		echo "${TIMESTAMP} ${HOST} ${PROGRAM_NAME}[${PID}]: ${LOG_LEVEL} ${MSG}"
	fi
 }

&gt; logit INFO "Processing data".

</code></pre></div></div>

<h3 id="debug">Debug</h3>

<ul>
  <li>Build in Debugging Help
    <ul>
      <li><code class="highlighter-rouge">-x</code> Prints commands as they execute</li>
      <li>After substitutions and expansions</li>
      <li>Called an x-trace, tracing, or print debugging</li>
      <li><code class="highlighter-rouge"><span class="c">#!/bin/bash -x</span></code></li>
      <li><code class="highlighter-rouge">set -x</code>
        <ul>
          <li><code class="highlighter-rouge">set +x</code> to stop debugging</li>
        </ul>
      </li>
      <li>ä½¿ç”¨ <code class="highlighter-rouge">-e</code>ï¼Œå½“è„šæœ¬å‡ºé”™æ—¶ï¼Œè‡ªåŠ¨exit
        <ul>
          <li><code class="highlighter-rouge"><span class="c">#!/bin/bash -ex</span></code></li>
          <li><code class="highlighter-rouge"><span class="c">#!/bin/bash -xe</span></code></li>
          <li><code class="highlighter-rouge"><span class="c">#!/bin/bash -e -x</span></code></li>
          <li><code class="highlighter-rouge"><span class="c">#!/bin/bash -x -e</span></code></li>
        </ul>
      </li>
      <li>ä½¿ç”¨<code class="highlighter-rouge">-v</code> æ‰“å°å‡ºshellæ‰§è¡Œçš„scriptå†…å®¹ï¼Œå¯ä»¥å’Œå…¶å®ƒå‚æ•°ä¸€èµ·ä½¿ç”¨</li>
    </ul>
  </li>
  <li>è„šæœ¬é‡Œä½¿ç”¨ <code class="highlighter-rouge">-x</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash -x</span>

<span class="nv">TEST_VAR</span><span class="o">=</span><span class="s2">"test"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TEST_VAR</span><span class="s2">"</span>

<span class="o">&gt;</span> ./debugging-01.sh <span class="c">#æ‰§è¡Œtestè„šæœ¬</span>
+ <span class="nv">TEST_VAR</span><span class="o">=</span><span class="nb">test</span> <span class="c">#è°ƒè¯•ä¿¡æ¯</span>
+ <span class="nb">echo test
test</span>

<span class="nt">-------</span>

<span class="c">#!/bin/bash</span>

<span class="nv">TEST_VAR</span><span class="o">=</span><span class="s2">"test"</span>
<span class="nb">set</span> <span class="nt">-x</span>
<span class="nb">echo</span> <span class="nv">$TEST_VAR</span>
<span class="nb">set</span> +x
<span class="nb">hostname</span>

<span class="o">&gt;</span>  lessons ./debugging-02.sh   
+ <span class="nb">echo test
test</span>
+ <span class="nb">set</span> +x
JaysondeMBP.fios-router.home

</code></pre></div></div>

<ul>
  <li>è„šæœ¬é‡Œä½¿ç”¨<code class="highlighter-rouge">-e</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash -ex</span>

<span class="nv">FILE_NAME</span><span class="o">=</span><span class="s2">"/not/here"</span>
<span class="nb">ls</span> <span class="nv">$FILE_NAME</span>
<span class="nb">echo</span> <span class="nv">$FILE_NAME</span>

<span class="o">&gt;</span>  ./debugging-04.sh   
+ <span class="nv">FILE_NAME</span><span class="o">=</span>/not/here
+ <span class="nb">ls</span> /not/here
<span class="nb">ls</span>: /not/here: No such file or directory

</code></pre></div></div>

<ul>
  <li>è„šæœ¬é‡Œä½¿ç”¨<code class="highlighter-rouge">-v</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash -vx</span>
<span class="nv">TEST_VAR</span><span class="o">=</span><span class="s2">"test"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TEST_VAR</span><span class="s2">"</span>

<span class="o">&gt;</span> ./debugging-06.sh   
<span class="c">#!/bin/bash -vx</span>
<span class="nv">TEST_VAR</span><span class="o">=</span><span class="s2">"test"</span> <span class="c">#è¯»å…¥æŒ‡ä»¤ -v</span>
+ <span class="nv">TEST_VAR</span><span class="o">=</span><span class="nb">test</span> <span class="c">#è¿›è¡Œå˜é‡æ›¿æ¢åæŒ‡ä»¤ -x</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TEST_VAR</span><span class="s2">"</span> <span class="c">#è¯»å…¥æŒ‡ä»¤ -v</span>
+ <span class="nb">echo test</span> <span class="c">#è¿›è¡Œå˜é‡æ›¿æ¢åæŒ‡ä»¤ -x</span>
<span class="nb">test</span>

</code></pre></div></div>

<h3 id="manaual-debugging">Manaual Debugging</h3>

<ul>
  <li>You can create your own debugging code.</li>
  <li>Use a special variable like DEBUG
    <ul>
      <li>DEBUG=true</li>
      <li>DEBUG=false</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">DEBUG</span><span class="o">=</span><span class="nb">true

</span><span class="k">if</span> <span class="nv">$DEBUG</span>
<span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Debug mode ON."</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"Debug mode OFF."</span>
<span class="k">fi</span>

</code></pre></div></div>

<ul>
  <li>å‡ ç§ä½¿ç”¨DEBUGçš„æ–¹å¼</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">$DEBUG</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"Debug mode OFF."</span> <span class="c">#logçš„æ–¹å¼</span>

<span class="nt">---</span>

<span class="c">#!/bin/bash</span>

<span class="nv">DEBUG</span><span class="o">=</span><span class="s2">"echo"</span>
<span class="nv">$DEBUG</span> <span class="nb">ls</span> <span class="c">#ä½¿ç”¨debugåšecho</span>

<span class="nt">---</span>

<span class="c">#!/bin/bash</span>

<span class="c">#DEBUG="echo"</span>
<span class="nv">$DEBUG</span> <span class="nb">ls</span> <span class="c">#ä½¿ç”¨debugåšæ³¨é‡Š</span>

</code></pre></div></div>

<ul>
  <li>è‡ªå®šä¹‰logå‡½æ•°</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>

debug<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Executing: </span><span class="nv">$@</span><span class="s2">"</span>
  <span class="nv">$@</span>
<span class="o">}</span>

debug <span class="nb">ls</span>

</code></pre></div></div>

<h2 id="13"> UNIXç¯å¢ƒ </h2>

<h3 id="shellå¯åŠ¨">Shellå¯åŠ¨</h3>

<ul>
  <li>å¯¹äºBashï¼Œç³»ç»Ÿä»ä¸Šåˆ°ä¸‹æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼Œå…ˆAï¼Œç„¶åBï¼ˆB1ï¼ŒB2ï¼ŒB3ï¼‰,ç„¶åC</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Option name</th>
      <th>Interactive login</th>
      <th>Interactive non-login</th>
      <th>Script</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/etc/profile</td>
      <td>A</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>/etc/bash.bashrc</td>
      <td>Â </td>
      <td>A</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.bashrc</td>
      <td>Â </td>
      <td>B</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.bash_profile</td>
      <td>B1</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.bash_login</td>
      <td>B2</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.profile</td>
      <td>B3</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>BASH_ENV</td>
      <td>Â </td>
      <td>Â </td>
      <td>A</td>
    </tr>
    <tr>
      <td>~/.bash_logout</td>
      <td>C</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>æ›´è¯¦ç»†çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="/assets/images/07/02/shell1.png" alt="" /></p>

<p>å¯¹äºBashï¼Œæœ€å¥½æŠŠè‡ªå·±çš„é…ç½®æ–‡ä»¶å†™åˆ°<code class="highlighter-rouge">~/.bashrc</code>é‡Œï¼Œåœ¨<code class="highlighter-rouge">~/.bash_profile</code> é‡Œé¢<code class="highlighter-rouge">source ~/.bashrc</code>ã€‚</p>

<ul>
  <li>å¯¹äºZsh(åœ¨<code class="highlighter-rouge">~/.zshrc</code>ç¼ºå¤±çš„æƒ…å†µä¸‹ä¼šè¯»å–<code class="highlighter-rouge">~/.profile</code>)</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Option name</th>
      <th>Interactive login</th>
      <th>Interactive non-login</th>
      <th>Script</th>
      <th>Â </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/etc/zshenv</td>
      <td>A</td>
      <td>A</td>
      <td>A</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.zshenv</td>
      <td>B</td>
      <td>B</td>
      <td>B</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>/etc/zprofile</td>
      <td>C</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.zprofile</td>
      <td>D</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>/etc/zshrc</td>
      <td>E</td>
      <td>C</td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>Â </td>
      <td>~/.zshrc</td>
      <td>F</td>
      <td>D</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>/etc/zlogin</td>
      <td>G</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.zlogin</td>
      <td>H</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>~/.zlogout</td>
      <td>I</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
    <tr>
      <td>/etc/zlogout</td>
      <td>J</td>
      <td>Â </td>
      <td>Â </td>
      <td>Â </td>
    </tr>
  </tbody>
</table>

<p>å¯¹äº Zshï¼ŒæŠŠè‡ªå·±çš„é…ç½®å†™åœ¨<code class="highlighter-rouge">~/.zshrc</code>ä¸­æœ€ä¿é™©</p>

<h3 id="unixä¸­çš„ç¯å¢ƒå˜é‡">UNIXä¸­çš„ç¯å¢ƒå˜é‡</h3>

<ul>
  <li>ç¯å¢ƒå˜é‡æ˜¯ç”¨æ¥å­˜å‚¨æœ‰å…³shellå›è¯çš„å·¥ä½œç¯å¢ƒä¿¡æ¯çš„å˜é‡
    <ul>
      <li><code class="highlighter-rouge">env</code> æŸ¥çœ‹å…¨éƒ¨ç¯å¢ƒå˜é‡</li>
      <li><code class="highlighter-rouge">set</code> æŸ¥çœ‹å½“å‰è¿›ç¨‹ä¸­å…¨éƒ¨çš„ç¯å¢ƒå˜é‡</li>
      <li><code class="highlighter-rouge">unset XXX</code> åˆ é™¤æ³¨å†Œçš„ç¯å¢ƒå˜é‡XXX</li>
    </ul>
  </li>
  <li>åˆ›å»ºç¯å¢ƒå˜é‡
    <ul>
      <li><code class="highlighter-rouge">export</code>å°†å±€éƒ¨å˜é‡å¯¼å‡ºä¸ºå½“å‰è¿›ç¨‹çš„å…¨å±€å˜é‡</li>
    </ul>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &gt;PATH_SELF=`pwd`
  &gt;echo $PATH_SELF //å±€éƒ¨å˜é‡
  &gt;export PATH_SELF  //å½“å‰è¿›ç¨‹çš„å…¨å±€å˜é‡
</code></pre></div>    </div>
  </li>
  <li>ä¿®æ”¹ç¯å¢ƒå˜é‡
    <ul>
      <li><code class="highlighter-rouge">$PATH</code>ä¿å­˜äº†æ‰€æœ‰shellå‘½ä»¤çš„è·¯å¾„ï¼Œä»¥<code class="highlighter-rouge">:</code>åˆ†å‰²</li>
      <li>å‘<code class="highlighter-rouge">PATH</code>ä¸­å¢åŠ è·¯å¾„:<code class="highlighter-rouge">PATH=$PATH:å¾…æ·»åŠ çš„è·¯å¾„</code>,ä¾‹å¦‚:</li>
      <li>ä½¿ç”¨<code class="highlighter-rouge">source</code>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ</li>
    </ul>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  export PATH="$PATH:$HOME/.z/z.sh"
  //ä¸Šé¢ä¸€å¥åŒ…å«äº†ä¸‰ä¸ªæ“ä½œï¼š
  (1) "$PATH:$HOME/.z/z.sh" åœ¨$PATHçš„è¿½åŠ ä¸Š":$HOME/.z/z.sh"å­—ç¬¦ä¸²
  (2) PATH = $PATH æ›´æ–°PATHçš„å€¼ 
  (3) export PATH å°†å±€éƒ¨å˜é‡å¯¼å‡ºä¸ºå½“å‰è¿›ç¨‹çš„å…¨å±€å˜é‡
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="ps1ps2ps3ps4">PS1,PS2,PS3,PS4</h3>

<ul>
  <li>PS4</li>
</ul>

<p>PS4ç”¨æ¥æ§åˆ¶åœ¨<code class="highlighter-rouge">-x</code>çš„æ¨¡å¼ä¸‹ï¼Œæ¯è¡Œå‰é¢æ˜¾ç¤ºçš„å†…å®¹ï¼Œé»˜è®¤æ˜¯<code class="highlighter-rouge">+</code>å·ï¼Œæ ¼å¼ä¸º</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS4='+ $BASH_SOURCE : $LINENO ' 
</code></pre></div></div>

<p>å…¶ä¸­<code class="highlighter-rouge">$BASH_SOURCE</code>å’Œ<code class="highlighter-rouge">LINENO</code>ä¸ºæ³¨å†Œçš„ç¯å¢ƒçš„å˜é‡</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash -x</span>
	
<span class="nv">PS4</span><span class="o">=</span><span class="s1">'+ $BASH_SOURCE : $LINENO : '</span>
	
<span class="nv">TEST_VAR</span><span class="o">=</span><span class="s2">"test"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$TEST_VAR</span><span class="s2">"</span>
	
<span class="o">&gt;</span> ./debugging-14.sh
+ <span class="nv">PS4</span><span class="o">=</span><span class="s1">'+ $BASH_SOURCE : $LINENO : '</span>
+ ./debugging-14.sh : 5 : <span class="nv">TEST_VAR</span><span class="o">=</span><span class="nb">test</span>
+ ./debugging-14.sh : 6 : <span class="nb">echo test
test</span>	
</code></pre></div></div>

<h3 id="dos-vs-linux-file-types">DOS vs Linux File Types</h3>

<ul>
  <li>Windowsçš„DOSå’Œlinuxçš„shellä¹‹é—´å¯èƒ½æœ‰å­—ç¬¦é›†ä¸å…¼å®¹çš„æƒ…å†µï¼Œå¯ä½¿ç”¨<code class="highlighter-rouge">file script.sh</code>å‘½ä»¤æŸ¥çœ‹å­—ç¬¦ç¼–ç :</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; file debugging-15.sh
debugging-15.sh: Bourne-Again shell script text executable, ASCII text

</code></pre></div></div>

<ul>
  <li>æˆ–è€…ä½¿ç”¨æ’ä»¶:<code class="highlighter-rouge">dos2unix script.sh</code>ï¼Œä¼šè‡ªåŠ¨å°†windowsä¸‹ä¸€äº›CRLFå»é™¤</li>
</ul>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="http://coolshell.cn/articles/8619.html">ä½ å¯èƒ½ä¸çŸ¥é“çš„Shell</a></li>
</ul>
:ET